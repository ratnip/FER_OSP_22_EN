<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Data wrangling | Let’s program in R</title>
  <meta name="description" content="R Coursebook" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Data wrangling | Let’s program in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="R Coursebook" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Data wrangling | Let’s program in R" />
  
  <meta name="twitter:description" content="R Coursebook" />
  

<meta name="author" content="Damir Pintar" />


<meta name="date" content="2023-01-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dates.html"/>
<link rel="next" href="ggplot2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>

<style type="text/css">
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 140px;
  height: 4	0px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  font-size:10 pt;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
</style>

<script>
 $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show solution</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show results</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show figure</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>(“Statistical Programming Fundamentals” course book)</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#foreword"><i class="fa fa-check"></i>Foreword</a></li>
</ul></li>
<li class="part"><span><b>I Basic elements of R</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#general-facts-about-r"><i class="fa fa-check"></i><b>1.1.1</b> General facts about R</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#r-alternatives"><i class="fa fa-check"></i><b>1.1.2</b> R alternatives</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#installing-software-support"><i class="fa fa-check"></i><b>1.2</b> Installing Software Support</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#overview-of-the-development-interface-rstudio"><i class="fa fa-check"></i><b>1.3</b> Overview of the development interface <em>RStudio</em></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#interactive-console"><i class="fa fa-check"></i><b>1.3.1</b> Interactive console</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#writing-r-scripts"><i class="fa fa-check"></i><b>1.3.2</b> Writing R scripts</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> <em>R Markdown</em></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#how-to-use-this-coursebook"><i class="fa fa-check"></i><b>1.4</b> How to use this coursebook?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipovi.html"><a href="tipovi.html"><i class="fa fa-check"></i><b>2</b> Basic data types and operators</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tipovi.html"><a href="tipovi.html#basic-data-types"><i class="fa fa-check"></i><b>2.1</b> Basic data types</a></li>
<li class="chapter" data-level="2.2" data-path="tipovi.html"><a href="tipovi.html#operators"><i class="fa fa-check"></i><b>2.2</b> Operators</a></li>
<li class="chapter" data-level="2.3" data-path="tipovi.html"><a href="tipovi.html#missing-unknown-and-non-existent-values"><i class="fa fa-check"></i><b>2.3</b> Missing, unknown, and non-existent values</a></li>
<li class="chapter" data-level="" data-path="tipovi.html"><a href="tipovi.html#homework-exercises"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vektori.html"><a href="vektori.html"><i class="fa fa-check"></i><b>3</b> Vectors, matrices and lists</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vektori.html"><a href="vektori.html#vector"><i class="fa fa-check"></i><b>3.1</b> Vector</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="vektori.html"><a href="vektori.html#creating-a-vector"><i class="fa fa-check"></i><b>3.1.1</b> Creating a vector</a></li>
<li class="chapter" data-level="3.1.2" data-path="vektori.html"><a href="vektori.html#vector-concatenation"><i class="fa fa-check"></i><b>3.1.2</b> Vector concatenation</a></li>
<li class="chapter" data-level="3.1.3" data-path="vektori.html"><a href="vektori.html#operator"><i class="fa fa-check"></i><b>3.1.3</b> Operator <code>[</code></a></li>
<li class="chapter" data-level="3.1.4" data-path="vektori.html"><a href="vektori.html#principles-of-vectorization-and-recycling"><i class="fa fa-check"></i><b>3.1.4</b> Principles of vectorization and recycling</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vektori.html"><a href="vektori.html#index-vectors"><i class="fa fa-check"></i><b>3.2</b> Index vectors</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="vektori.html"><a href="vektori.html#positional-indexing"><i class="fa fa-check"></i><b>3.2.1</b> Positional Indexing</a></li>
<li class="chapter" data-level="3.2.2" data-path="vektori.html"><a href="vektori.html#conditional-indexing"><i class="fa fa-check"></i><b>3.2.2</b> Conditional indexing</a></li>
<li class="chapter" data-level="3.2.3" data-path="vektori.html"><a href="vektori.html#label-based-indexing"><i class="fa fa-check"></i><b>3.2.3</b> Label-based indexing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vektori.html"><a href="vektori.html#matrices-and-arrays"><i class="fa fa-check"></i><b>3.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.4" data-path="vektori.html"><a href="vektori.html#matrix-slicing"><i class="fa fa-check"></i><b>3.4</b> Matrix slicing</a></li>
<li class="chapter" data-level="3.5" data-path="vektori.html"><a href="vektori.html#example-3.2---matrix-slicing"><i class="fa fa-check"></i><b>3.5</b> Example 3.2 - matrix slicing</a></li>
<li class="chapter" data-level="3.6" data-path="vektori.html"><a href="vektori.html#lists"><i class="fa fa-check"></i><b>3.6</b> Lists</a></li>
<li class="chapter" data-level="" data-path="vektori.html"><a href="vektori.html#homework-exercises-1"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="okviri.html"><a href="okviri.html"><i class="fa fa-check"></i><b>4</b> Data frames and factors</a>
<ul>
<li class="chapter" data-level="4.1" data-path="okviri.html"><a href="okviri.html#data-frames"><i class="fa fa-check"></i><b>4.1</b> Data frames</a></li>
<li class="chapter" data-level="4.2" data-path="okviri.html"><a href="okviri.html#selecting-rows-and-columns"><i class="fa fa-check"></i><b>4.2</b> Selecting rows and columns</a></li>
<li class="chapter" data-level="4.3" data-path="okviri.html"><a href="okviri.html#adding-and-deleting-rows-and-columns"><i class="fa fa-check"></i><b>4.3</b> Adding and deleting rows and columns</a></li>
<li class="chapter" data-level="4.4" data-path="okviri.html"><a href="okviri.html#factors"><i class="fa fa-check"></i><b>4.4</b> Factors</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="okviri.html"><a href="okviri.html#example-4.1---mishandling-factorization"><i class="fa fa-check"></i><b>4.4.1</b> Example 4.1 - mishandling factorization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="okviri.html"><a href="okviri.html#homework-exercises-2"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control.html"><a href="control.html"><i class="fa fa-check"></i><b>5</b> Conditional statements and programming loops</a>
<ul>
<li class="chapter" data-level="5.1" data-path="control.html"><a href="control.html#flow-control-commands"><i class="fa fa-check"></i><b>5.1</b> Flow control commands</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="control.html"><a href="control.html#conditional-execution"><i class="fa fa-check"></i><b>5.1.1</b> Conditional execution</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="control.html"><a href="control.html#loops"><i class="fa fa-check"></i><b>5.2</b> Loops</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="control.html"><a href="control.html#therepeat-loop"><i class="fa fa-check"></i><b>5.2.1</b> The<code>repeat</code> loop</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="control.html"><a href="control.html#example-5.1---the-repeat-loop"><i class="fa fa-check"></i><b>5.3</b> Example 5.1 - the <code>repeat</code> loop</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="control.html"><a href="control.html#the-while-loop"><i class="fa fa-check"></i><b>5.3.1</b> The <code>while</code> loop</a></li>
<li class="chapter" data-level="5.3.2" data-path="control.html"><a href="control.html#the-for-loop"><i class="fa fa-check"></i><b>5.3.2</b> The <code>for</code> loop</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="control.html"><a href="control.html#homework-exercises-3"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>6</b> Packages, built-in functions and environments</a>
<ul>
<li class="chapter" data-level="6.1" data-path="packages.html"><a href="packages.html#working-with-packages"><i class="fa fa-check"></i><b>6.1</b> Working with packages</a></li>
<li class="chapter" data-level="6.2" data-path="packages.html"><a href="packages.html#built-in-functions"><i class="fa fa-check"></i><b>6.2</b> Built-in functions</a></li>
<li class="chapter" data-level="6.3" data-path="packages.html"><a href="packages.html#environments"><i class="fa fa-check"></i><b>6.3</b> Environments</a></li>
<li class="chapter" data-level="" data-path="packages.html"><a href="packages.html#homework-exercises-4"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="user.html"><a href="user.html"><i class="fa fa-check"></i><b>7</b> User Defined Functions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="user.html"><a href="user.html#user-defined-functions"><i class="fa fa-check"></i><b>7.1</b> User defined functions</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="user.html"><a href="user.html#defining-a-new-function"><i class="fa fa-check"></i><b>7.1.1</b> Defining a new function</a></li>
<li class="chapter" data-level="7.1.2" data-path="user.html"><a href="user.html#the-copy-on-modify-principle"><i class="fa fa-check"></i><b>7.1.2</b> The “copy-on-modify” principle</a></li>
<li class="chapter" data-level="7.1.3" data-path="user.html"><a href="user.html#example-7.1---copy-on-modify"><i class="fa fa-check"></i><b>7.1.3</b> Example 7.1 - “copy-on-modify”</a></li>
<li class="chapter" data-level="7.1.4" data-path="user.html"><a href="user.html#example-7.2---copy-on-modify-2"><i class="fa fa-check"></i><b>7.1.4</b> Example 7.2 - “copy-on-modify (2)”</a></li>
<li class="chapter" data-level="7.1.5" data-path="user.html"><a href="user.html#example-7.3---copy-on-modify-and-environments"><i class="fa fa-check"></i><b>7.1.5</b> Example 7.3 - “copy-on-modify” and environments</a></li>
<li class="chapter" data-level="7.1.6" data-path="user.html"><a href="user.html#example-7.4---the---operator"><i class="fa fa-check"></i><b>7.1.6</b> Example 7.4 - the <code>&lt;&lt;-</code> operator</a></li>
<li class="chapter" data-level="7.1.7" data-path="user.html"><a href="user.html#example-7.5---changing-a-data-frame-column-with-the---operator"><i class="fa fa-check"></i><b>7.1.7</b> Example 7.5 - changing a data frame column with the <code>&lt;&lt;-</code> operator</a></li>
<li class="chapter" data-level="7.1.8" data-path="user.html"><a href="user.html#function-as-an-object"><i class="fa fa-check"></i><b>7.1.8</b> Function as an object</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="user.html"><a href="user.html#the-apply-family"><i class="fa fa-check"></i><b>7.2</b> The <code>apply</code> family</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="user.html"><a href="user.html#the-apply-function"><i class="fa fa-check"></i><b>7.2.1</b> The <code>apply</code> function</a></li>
<li class="chapter" data-level="7.2.2" data-path="user.html"><a href="user.html#the-lapply-sapply-and-vapply-functions"><i class="fa fa-check"></i><b>7.2.2</b> The <code>lapply</code>, <code>sapply</code> and <code>vapply</code> functions</a></li>
<li class="chapter" data-level="7.2.3" data-path="user.html"><a href="user.html#other-functions-from-the-apply-family-and-the-available-alternatives"><i class="fa fa-check"></i><b>7.2.3</b> Other functions from the <code>apply</code> family and the available alternatives</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="user.html"><a href="user.html#homework-exercises-5"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="objects.html"><a href="objects.html"><i class="fa fa-check"></i><b>8</b> Object oriented systems in R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="objects.html"><a href="objects.html#object-oriented-systems-in-r"><i class="fa fa-check"></i><b>8.1</b> Object-oriented systems in R</a></li>
<li class="chapter" data-level="8.2" data-path="objects.html"><a href="objects.html#overview-of-the-s3-object-model"><i class="fa fa-check"></i><b>8.2</b> Overview of the S3 object model</a></li>
<li class="chapter" data-level="8.3" data-path="objects.html"><a href="objects.html#generic-functions"><i class="fa fa-check"></i><b>8.3</b> Generic functions</a></li>
<li class="chapter" data-level="8.4" data-path="objects.html"><a href="objects.html#adding-generic-functions-to-an-object"><i class="fa fa-check"></i><b>8.4</b> Adding generic functions to an object</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="objects.html"><a href="objects.html#conclusion-on-s3-objects"><i class="fa fa-check"></i><b>8.4.1</b> Conclusion on S3 objects</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="objects.html"><a href="objects.html#short-overview-of-s4-objects"><i class="fa fa-check"></i><b>8.5</b> Short overview of S4 objects</a></li>
<li class="chapter" data-level="" data-path="objects.html"><a href="objects.html#homework-exercises-6"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="part"><span><b>II Data management and visualizations</b></span></li>
<li class="chapter" data-level="9" data-path="pipe.html"><a href="pipe.html"><i class="fa fa-check"></i><b>9</b> Pipeline operator and tidy data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="pipe.html"><a href="pipe.html#pipeline-operator"><i class="fa fa-check"></i><b>9.1</b> Pipeline operator</a></li>
<li class="chapter" data-level="9.2" data-path="pipe.html"><a href="pipe.html#tidy-data"><i class="fa fa-check"></i><b>9.2</b> Tidy data</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="pipe.html"><a href="pipe.html#the-pivot_longer-andpivot_wider-functions"><i class="fa fa-check"></i><b>9.2.1</b> The <code>pivot_longer</code> and<code>pivot_wider</code> functions</a></li>
<li class="chapter" data-level="9.2.2" data-path="pipe.html"><a href="pipe.html#the-separate-and-unite-functions"><i class="fa fa-check"></i><b>9.2.2</b> The <code>separate</code> and <code>unite</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pipe.html"><a href="pipe.html#homework-exercises-7"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dates.html"><a href="dates.html"><i class="fa fa-check"></i><b>10</b> Working with dates and character strings</a>
<ul>
<li class="chapter" data-level="10.1" data-path="dates.html"><a href="dates.html#working-with-dates"><i class="fa fa-check"></i><b>10.1</b> Working with dates</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="dates.html"><a href="dates.html#the-date-class"><i class="fa fa-check"></i><b>10.1.1</b> The <code>Date</code> class</a></li>
<li class="chapter" data-level="10.1.2" data-path="dates.html"><a href="dates.html#theposixct-andposixlt-classes"><i class="fa fa-check"></i><b>10.1.2</b> The<code>POSIXct</code> and<code>POSIXlt</code> classes</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="dates.html"><a href="dates.html#the-lubridate-package"><i class="fa fa-check"></i><b>10.2</b> The <code>lubridate</code> package</a></li>
<li class="chapter" data-level="10.3" data-path="dates.html"><a href="dates.html#working-with-character-strings"><i class="fa fa-check"></i><b>10.3</b> Working with character strings</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="dates.html"><a href="dates.html#text-analysis-and-regular-expressions"><i class="fa fa-check"></i><b>10.3.1</b> Text analysis and regular expressions</a></li>
<li class="chapter" data-level="10.3.2" data-path="dates.html"><a href="dates.html#the-stringr-package"><i class="fa fa-check"></i><b>10.3.2</b> The <code>stringr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dates.html"><a href="dates.html#homework-exercises-8"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>11</b> Data wrangling</a>
<ul>
<li class="chapter" data-level="11.1" data-path="dplyr.html"><a href="dplyr.html#data-wrangling-with-package-dplyr"><i class="fa fa-check"></i><b>11.1</b> Data wrangling with package <code>dplyr</code></a></li>
<li class="chapter" data-level="11.2" data-path="dplyr.html"><a href="dplyr.html#dataset-titanic"><i class="fa fa-check"></i><b>11.2</b> Dataset: <em>Titanic</em></a></li>
<li class="chapter" data-level="11.3" data-path="dplyr.html"><a href="dplyr.html#creating-a-subset-of-observations-with-filter-andslice"><i class="fa fa-check"></i><b>11.3</b> Creating a subset of observations with <code>filter</code> and<code>slice</code></a></li>
<li class="chapter" data-level="11.4" data-path="dplyr.html"><a href="dplyr.html#creating-a-subset-of-columns-with-select"><i class="fa fa-check"></i><b>11.4</b> Creating a subset of columns with <code>select</code></a></li>
<li class="chapter" data-level="11.5" data-path="dplyr.html"><a href="dplyr.html#creating-new-columns-with-mutate"><i class="fa fa-check"></i><b>11.5</b> Creating new columns with <code>mutate</code></a></li>
<li class="chapter" data-level="11.6" data-path="dplyr.html"><a href="dplyr.html#sample-dataset-houston-flights"><i class="fa fa-check"></i><b>11.6</b> Sample Dataset: <em>Houston flights</em></a></li>
<li class="chapter" data-level="11.7" data-path="dplyr.html"><a href="dplyr.html#grouping-and-aggregation-with-group_by-andsummarise"><i class="fa fa-check"></i><b>11.7</b> Grouping and aggregation with <code>group_by</code> and<code>summarise</code></a></li>
<li class="chapter" data-level="11.8" data-path="dplyr.html"><a href="dplyr.html#merging-data-frames-with-join-functions"><i class="fa fa-check"></i><b>11.8</b> Merging data frames with join functions</a></li>
<li class="chapter" data-level="11.9" data-path="dplyr.html"><a href="dplyr.html#integrating-dplyr-with-relational-databases"><i class="fa fa-check"></i><b>11.9</b> Integrating <code>dplyr</code> with relational databases</a></li>
<li class="chapter" data-level="" data-path="dplyr.html"><a href="dplyr.html#homework-exercises-9"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>12</b> Visualising data with <code>ggplot2</code> package</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ggplot2.html"><a href="ggplot2.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>12.1</b> Exploratory data analysis</a></li>
<li class="chapter" data-level="12.2" data-path="ggplot2.html"><a href="ggplot2.html#data-visualization-using-the-r-language"><i class="fa fa-check"></i><b>12.2</b> Data visualization using the R language</a></li>
<li class="chapter" data-level="12.3" data-path="ggplot2.html"><a href="ggplot2.html#grammar-of-graphics-and-the-ggplot2-package"><i class="fa fa-check"></i><b>12.3</b> Grammar of graphics and the <code>ggplot2</code> package</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="ggplot2.html"><a href="ggplot2.html#aspects-of-data-aesthetics-and-geometries"><i class="fa fa-check"></i><b>12.3.1</b> Aspects of data, aesthetics and geometries</a></li>
<li class="chapter" data-level="12.3.2" data-path="ggplot2.html"><a href="ggplot2.html#fixed-geometry-parameters"><i class="fa fa-check"></i><b>12.3.2</b> Fixed geometry parameters</a></li>
<li class="chapter" data-level="12.3.3" data-path="ggplot2.html"><a href="ggplot2.html#the-aspects-of-statistics-and-position"><i class="fa fa-check"></i><b>12.3.3</b> The aspects of statistics and position</a></li>
<li class="chapter" data-level="12.3.4" data-path="ggplot2.html"><a href="ggplot2.html#the-relationship-between-geometry-and-statistics"><i class="fa fa-check"></i><b>12.3.4</b> The relationship between geometry and statistics</a></li>
<li class="chapter" data-level="12.3.5" data-path="ggplot2.html"><a href="ggplot2.html#storing-a-graph-to-a-file"><i class="fa fa-check"></i><b>12.3.5</b> Storing a graph to a file</a></li>
<li class="chapter" data-level="12.3.6" data-path="ggplot2.html"><a href="ggplot2.html#aspects-of-scale-coordinate-system-and-theme"><i class="fa fa-check"></i><b>12.3.6</b> Aspects of scale, coordinate system and theme</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="ggplot2.html"><a href="ggplot2.html#tu"><i class="fa fa-check"></i><b>12.4</b> TU</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="ggplot2.html"><a href="ggplot2.html#conditional-faceted-graphs"><i class="fa fa-check"></i><b>12.4.1</b> Conditional (faceted) graphs</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="ggplot2.html"><a href="ggplot2.html#graphs-in-exploratory-analysis-and-reporting"><i class="fa fa-check"></i><b>12.5</b> Graphs in Exploratory Analysis and Reporting</a></li>
<li class="chapter" data-level="" data-path="ggplot2.html"><a href="ggplot2.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>13</b> Selected Machine Learning Methods: Regression Analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="regression.html"><a href="regression.html#machine-learning---a-short-introduction"><i class="fa fa-check"></i><b>13.1</b> Machine learning - a short introduction</a></li>
<li class="chapter" data-level="13.2" data-path="regression.html"><a href="regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>13.2</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="regression.html"><a href="regression.html#the-lm-function"><i class="fa fa-check"></i><b>13.2.1</b> The <code>lm</code> function</a></li>
<li class="chapter" data-level="13.2.2" data-path="regression.html"><a href="regression.html#linear-regression-and-categorical-variables"><i class="fa fa-check"></i><b>13.2.2</b> Linear regression and categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="regression.html"><a href="regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>13.3</b> Multiple linear regression</a></li>
<li class="chapter" data-level="" data-path="regression.html"><a href="regression.html#homework-exercises-10"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="predictive_Modeling.html"><a href="predictive_Modeling.html"><i class="fa fa-check"></i><b>14</b> Introduction to Predictive Modeling</a>
<ul>
<li class="chapter" data-level="14.1" data-path="predictive_Modeling.html"><a href="predictive_Modeling.html#what-is-predictive-modeling"><i class="fa fa-check"></i><b>14.1</b> What is predictive modeling?</a></li>
<li class="chapter" data-level="14.2" data-path="predictive_Modeling.html"><a href="predictive_Modeling.html#creating-training-and-test-datasets"><i class="fa fa-check"></i><b>14.2</b> Creating training and test datasets</a></li>
<li class="chapter" data-level="14.3" data-path="predictive_Modeling.html"><a href="predictive_Modeling.html#classification-predictive-models---knn-classification"><i class="fa fa-check"></i><b>14.3</b> Classification Predictive Models - kNN Classification</a></li>
<li class="chapter" data-level="14.4" data-path="predictive_Modeling.html"><a href="predictive_Modeling.html#package-caret-and-predictive-modeling"><i class="fa fa-check"></i><b>14.4</b> Package <code>caret</code> and predictive modeling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Let’s program in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> Data wrangling<a href="dplyr.html#dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<hr />
<div id="data-wrangling-with-package-dplyr" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Data wrangling with package <code>dplyr</code><a href="dplyr.html#data-wrangling-with-package-dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>dplyr</code> package is one of the newer <em>R</em> language packages whose main function is to efficiently and easily manage data frames with a set of intuitively designed functions. At the time of writing this lesson, <a href = "https://www.rdocumentation.org/"> is at the top of the list of most popular packages</a> despite strong “competition” in this area made up of extremely popular packages such as <code>plyr</code>, <code>data.table</code> and base, traditional methods for working with data frames. Either of these options is a good choice, and although the <code>dplyr</code> package is not the most efficient in terms of performance (by far the best performance is currently offered by the<code>data.table</code> package), the advantage of this package is its intuitive, readable syntax that makes programming and working with data frames fast and easy, representing a great choice for developers who are familiar with <em>R</em> or simply want to focus on working with data through readable, easy-to-use program code.</p>
<p>The specific advantages of the <code>dplyr</code> package are:</p>
<ul>
<li>simple syntax (similar to SQL but procedural) that uses the five main “verbs” to manipulate data frames and as such defines a standalone language-within-language of sorts</li>
<li>higher efficiency compared to the methods offered by the basic package (initially <code>dplyr</code> was designed for greater programming efficiency, not necessarily for better performance, but in the meantime the implementation of certain routines in C also allowed for improved computational performance)</li>
<li>integration with relational databases and big data sources (certain <code>dplyr</code> functions can be used directly on tables in the database by automatically translating those functions into SQL commands)</li>
</ul>
<p>The aforementioned basic “five verbs” offered by the <code>dplyr</code> package are as follows:</p>
<ul>
<li><code>filter</code> - for filtering the dataset by rows</li>
<li><code>select</code> - for selecting individual columns</li>
<li><code>arrange</code> - for changing the order of the rows</li>
<li><code>mutate</code> - for creating new columns from existing ones</li>
<li><code>summarise</code> - for data aggregation</li>
</ul>
<p>In addition to these five basic verbs, we often use:</p>
<ul>
<li><code>group_by</code> for grouping data within a dataset</li>
<li>the <code>join</code> family of functions for merging data frames</li>
</ul>
<p>SQL language experts will easily notice the parallels between the SQL language and the stated <code>dplyr</code> functionality. The biggest difference is that SQL works “declaratively”, i.e. we have to follow the rules of building an SQL command that “does everything at once”, while in <em>R</em> using the functions of the <code>dplyr</code> package and the already familiar operator<code>%&gt;%</code>actions can be performed on datasets procedurally, with clear data processing flow going from left to right.</p>
<p>Before we do a detailed look at the functionality of the <code>dplyr</code> package, let’s get acquainted with one of the two datasets we will be using during this lesson.</p>
</div>
<div id="dataset-titanic" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Dataset: <em>Titanic</em><a href="dplyr.html#dataset-titanic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will choose one commonly used dataset - <em>“Titanic Passenger Survival Dataset”</em>. This dataset contains information about the passengers of the cruise shipTitanic which sank on 14 April 1912, whereupon only 706 out of 2223 passengers survived. This dataset contains, amongst other things, passengers’ names, gender, age, passenger class, etc. There is a version of this dataset that comes with <em>R</em> distribution itself, but we will use its extended version from a <em>Kaggle</em> competition <em>“Titanic: Machine Learning From Disaster”</em> which can be found more at <a href = "https://www.kaggle.com/c/titanic"> this link</a>.</p>
<p>Let’s load this data set using the <code>read_csv</code> function, a<code>readr</code> package function that “upgrades” the <code>read.csv</code> function. Also, instead of the <code>str</code> function, let’s try to use its equivalent, the <code>glimpse</code> function, provided by the <code>dplyr</code> package.</p>
<hr />
<p><strong>Exercise 11.1 - dataset <code>Titanic</code></strong></p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="dplyr.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data set from the file `Titanic.csv` into the variable` # `titanic` using the `read_csv` function from the `readr` package</span></span>
<span id="cb453-2"><a href="dplyr.html#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="co"># please read the documentation before using the function</span></span>
<span id="cb453-3"><a href="dplyr.html#cb453-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-4"><a href="dplyr.html#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="co"># view the structure of the `titanic` dataframe </span></span>
<span id="cb453-5"><a href="dplyr.html#cb453-5" aria-hidden="true" tabindex="-1"></a><span class="co"># using the `glimps` function</span></span>
<span id="cb453-6"><a href="dplyr.html#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="co"># and check the first few rows with the `head` function</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="dplyr.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data set from the file `Titanic.csv` into the variable` # `titanic` using the `read_csv` function from the `readr` package</span></span>
<span id="cb454-2"><a href="dplyr.html#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="co"># please read the documentation before using the function</span></span>
<span id="cb454-3"><a href="dplyr.html#cb454-3" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;Titanic.csv&quot;</span>)</span>
<span id="cb454-4"><a href="dplyr.html#cb454-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-5"><a href="dplyr.html#cb454-5" aria-hidden="true" tabindex="-1"></a><span class="co"># view the structure of the `titanic` dataframe </span></span>
<span id="cb454-6"><a href="dplyr.html#cb454-6" aria-hidden="true" tabindex="-1"></a><span class="co"># using the `glimpse` function</span></span>
<span id="cb454-7"><a href="dplyr.html#cb454-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and check the first few rows with the `head` function</span></span>
<span id="cb454-8"><a href="dplyr.html#cb454-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(titanic)</span>
<span id="cb454-9"><a href="dplyr.html#cb454-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic)</span></code></pre></div>
<pre><code>## Rows: 891 Columns: 12
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): Name, Sex, Ticket, Cabin, Embarked
## dbl (7): PassengerId, Survived, Pclass, Age, SibSp, Parch, Fare
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## Rows: 891
## Columns: 12
## $ PassengerId &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
## $ Survived    &lt;dbl&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1…
## $ Pclass      &lt;dbl&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3, 2, 3, 3…
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bradley (Fl…
## $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;male&quot;, &quot;mal…
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, 39, 14, …
## $ SibSp       &lt;dbl&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4, 0, 1, 0…
## $ Parch       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1, 0, 0, 0…
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;113803&quot;, &quot;37…
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, 51.8625,…
## $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, &quot;G6&quot;, &quot;C…
## $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;…
## # A tibble: 6 × 12
##   PassengerId Survived Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin
##         &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
## 1           1        0      3 Braund… male     22     1     0 A/5 2…  7.25 &lt;NA&gt; 
## 2           2        1      1 Cuming… fema…    38     1     0 PC 17… 71.3  C85  
## 3           3        1      3 Heikki… fema…    26     0     0 STON/…  7.92 &lt;NA&gt; 
## 4           4        1      1 Futrel… fema…    35     1     0 113803 53.1  C123 
## 5           5        0      3 Allen,… male     35     0     0 373450  8.05 &lt;NA&gt; 
## 6           6        0      3 Moran,… male     NA     0     0 330877  8.46 &lt;NA&gt; 
## # … with 1 more variable: Embarked &lt;chr&gt;</code></pre>
</div>
<hr />
<p>Why use the function <code>read_csv</code> instead of its counterpart with a similar name, <code>read.csv</code>? There are several reasons:</p>
<ul>
<li>greater autonomy, i.e. better inference of column types</li>
<li>faster processing speed</li>
<li>provides status information for easier error detection</li>
<li><strong>no automatic categorization</strong></li>
<li>the loaded object is automatically converted into a “<em>tibble</em>”</li>
</ul>
<p>All these reasons are clear, except perhaps the last one. What is a “<em>tibble</em>”? This is a colloquial name for an object of class <code>tbl_df</code>, which is an upgrade of sorts of the <code>data.frame</code> class, i.e. the basic data frame. The biggest advantage of this type of object is that when you try to print the whole data frame to the screen (which usually happens by mistake and which can result in a “freezing” of the <em>R</em> console), a special function will be called that will print only part of the frame and be able to resume operation immediately .</p>
<p>If we want to “upgrade” an existing dataframe to a <em>tibble</em>, we can do this with the <code>as_tibble</code> command (note that functions in the <code>tidyverse</code> collection often contain an underscore <code>_</code>, to help distinguish them as upgrades of basic <em>R</em> constructs which have similar names but use a dot <code>.</code>).</p>
<p>We can fine tune how tibbles get printed by using the <code>options</code> function and the parameters <code>tibble.print_max</code> and `tibble.width, for example:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="dplyr.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to see a maximum of 10 rows and always print all columns</span></span>
<span id="cb457-2"><a href="dplyr.html#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tibble.print_max =</span> <span class="dv">10</span>, <span class="at">tibble.width =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<p>An easier way for a one-off printing of more than 10 rows we can simply add a paramter <code>n</code> to the default <code>print</code> function:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="dplyr.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `df` is of class `tbl_df`, I want to see 50 lines printed</span></span>
<span id="cb458-2"><a href="dplyr.html#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df, <span class="at">n =</span> <span class="dv">50</span>)</span></code></pre></div>
<hr />
<p>Before proceeding, it would be a good idea to get acquainted with the data set we will be using, either through a more detailed research of the dataset, or by collecting documentation on the dataset. The brief description of the dataset itself, collected from the official Keggle page of the competition, is as follows:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="dplyr.html#cb459-1" aria-hidden="true" tabindex="-1"></a>VARIABLE DESCRIPTIONS<span class="sc">:</span></span>
<span id="cb459-2"><a href="dplyr.html#cb459-2" aria-hidden="true" tabindex="-1"></a>survival        Survival</span>
<span id="cb459-3"><a href="dplyr.html#cb459-3" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">0</span> <span class="ot">=</span> No; <span class="dv">1</span> <span class="ot">=</span> Yes)</span>
<span id="cb459-4"><a href="dplyr.html#cb459-4" aria-hidden="true" tabindex="-1"></a>pclass          Passenger Class</span>
<span id="cb459-5"><a href="dplyr.html#cb459-5" aria-hidden="true" tabindex="-1"></a>                (<span class="dv">1</span> <span class="ot">=</span> 1st; <span class="dv">2</span> <span class="ot">=</span> 2nd; <span class="dv">3</span> <span class="ot">=</span> 3rd)</span>
<span id="cb459-6"><a href="dplyr.html#cb459-6" aria-hidden="true" tabindex="-1"></a>name            Name</span>
<span id="cb459-7"><a href="dplyr.html#cb459-7" aria-hidden="true" tabindex="-1"></a>sex             Sex</span>
<span id="cb459-8"><a href="dplyr.html#cb459-8" aria-hidden="true" tabindex="-1"></a>age             Age</span>
<span id="cb459-9"><a href="dplyr.html#cb459-9" aria-hidden="true" tabindex="-1"></a>sibsp           Number of Siblings<span class="sc">/</span>Spouses Aboard</span>
<span id="cb459-10"><a href="dplyr.html#cb459-10" aria-hidden="true" tabindex="-1"></a>parch           Number of Parents<span class="sc">/</span>Children Aboard</span>
<span id="cb459-11"><a href="dplyr.html#cb459-11" aria-hidden="true" tabindex="-1"></a>ticket          Ticket Number</span>
<span id="cb459-12"><a href="dplyr.html#cb459-12" aria-hidden="true" tabindex="-1"></a>fare            Passenger Fare</span>
<span id="cb459-13"><a href="dplyr.html#cb459-13" aria-hidden="true" tabindex="-1"></a>cabin           Cabin</span>
<span id="cb459-14"><a href="dplyr.html#cb459-14" aria-hidden="true" tabindex="-1"></a>embarked        Port of Embarkation</span>
<span id="cb459-15"><a href="dplyr.html#cb459-15" aria-hidden="true" tabindex="-1"></a>                (<span class="at">C =</span> Cherbourg; <span class="at">Q =</span> Queenstown; <span class="at">S =</span> Southampton)</span>
<span id="cb459-16"><a href="dplyr.html#cb459-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-17"><a href="dplyr.html#cb459-17" aria-hidden="true" tabindex="-1"></a>SPECIAL NOTES<span class="sc">:</span></span>
<span id="cb459-18"><a href="dplyr.html#cb459-18" aria-hidden="true" tabindex="-1"></a>Pclass is a proxy <span class="cf">for</span> socio<span class="sc">-</span>economic <span class="fu">status</span> (SES)</span>
<span id="cb459-19"><a href="dplyr.html#cb459-19" aria-hidden="true" tabindex="-1"></a> 1st <span class="sc">~</span> Upper; 2nd <span class="sc">~</span> Middle; 3rd <span class="sc">~</span> Lower</span>
<span id="cb459-20"><a href="dplyr.html#cb459-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-21"><a href="dplyr.html#cb459-21" aria-hidden="true" tabindex="-1"></a>Age is <span class="cf">in</span> Years; Fractional <span class="cf">if</span> Age less than <span class="fu">One</span> (<span class="dv">1</span>)</span>
<span id="cb459-22"><a href="dplyr.html#cb459-22" aria-hidden="true" tabindex="-1"></a> If the Age is Estimated, it is <span class="cf">in</span> the form xx<span class="fl">.5</span></span>
<span id="cb459-23"><a href="dplyr.html#cb459-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-24"><a href="dplyr.html#cb459-24" aria-hidden="true" tabindex="-1"></a>With respect to the family relation <span class="fu">variables</span> (i.e. sibsp and parch)</span>
<span id="cb459-25"><a href="dplyr.html#cb459-25" aria-hidden="true" tabindex="-1"></a>some relations were ignored.  The following are the definitions used</span>
<span id="cb459-26"><a href="dplyr.html#cb459-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sibsp and parch.</span>
<span id="cb459-27"><a href="dplyr.html#cb459-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-28"><a href="dplyr.html#cb459-28" aria-hidden="true" tabindex="-1"></a>Sibling<span class="sc">:</span>  Brother, Sister, Stepbrother, or Stepsister of Passenger Aboard Titanic</span>
<span id="cb459-29"><a href="dplyr.html#cb459-29" aria-hidden="true" tabindex="-1"></a>Spouse<span class="sc">:</span>   Husband or Wife of Passenger Aboard <span class="fu">Titanic</span> (Mistresses and Fiances Ignored)</span>
<span id="cb459-30"><a href="dplyr.html#cb459-30" aria-hidden="true" tabindex="-1"></a>Parent<span class="sc">:</span>   Mother or Father of Passenger Aboard Titanic</span>
<span id="cb459-31"><a href="dplyr.html#cb459-31" aria-hidden="true" tabindex="-1"></a>Child<span class="sc">:</span>    Son, Daughter, Stepson, or Stepdaughter of Passenger Aboard Titanic</span>
<span id="cb459-32"><a href="dplyr.html#cb459-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-33"><a href="dplyr.html#cb459-33" aria-hidden="true" tabindex="-1"></a>Other family relatives excluded from this study include cousins,</span>
<span id="cb459-34"><a href="dplyr.html#cb459-34" aria-hidden="true" tabindex="-1"></a>nephews<span class="sc">/</span>nieces, aunts<span class="sc">/</span>uncles, and <span class="cf">in</span><span class="sc">-</span>laws.  Some children travelled</span>
<span id="cb459-35"><a href="dplyr.html#cb459-35" aria-hidden="true" tabindex="-1"></a>only with a nanny, therefore parch<span class="ot">=</span><span class="dv">0</span> <span class="cf">for</span> them.  As well, some</span>
<span id="cb459-36"><a href="dplyr.html#cb459-36" aria-hidden="true" tabindex="-1"></a>travelled with very close friends or neighbors <span class="cf">in</span> a village, however,</span>
<span id="cb459-37"><a href="dplyr.html#cb459-37" aria-hidden="true" tabindex="-1"></a>the definitions do not support such relations.</span></code></pre></div>
<p>At this point, it should be considered whether the dataset includes some categorical data. As we have learned, unlike the <code>read.csv</code> function that automatically factorizes all character columns (which is not recommended), the <code>read_csv</code> function from the <code>readr</code> package does not factorize anything, but rather leaves that to the analyst. While this represents additional work for the analyst, the level of control and robustness that is obtained is more than a sufficient compromise.</p>
<p>In the <code>titanic</code> dataset we notice the following categorical variables:</p>
<ul>
<li><em>Survival</em> (survival - 2 categories: 0 and 1)</li>
<li><em>Pclass</em> (passenger class - 3 categories: 1, 2 and 3)</li>
<li><em>Sex</em> (gender - 2 categories: “M” and “F”)</li>
<li><em>Embarked</em> (port of embarkation - 3 categories: “C”, “Q” and “S”)</li>
</ul>
<p>Let’s factorize the columns listed.</p>
<p><strong>Exercise 11.2 - factorizing the columns of the <code>Titanic</code> dataset</strong></p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="dplyr.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the `Survival`,` Pclass`, `Sex` and` Embarked` columns</span></span>
<span id="cb460-2"><a href="dplyr.html#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the `titanic` data frame into factors</span></span>
<span id="cb460-3"><a href="dplyr.html#cb460-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-4"><a href="dplyr.html#cb460-4" aria-hidden="true" tabindex="-1"></a><span class="co"># briefly explore the `titanic` data frame</span></span>
<span id="cb460-5"><a href="dplyr.html#cb460-5" aria-hidden="true" tabindex="-1"></a><span class="co"># using the &#39;glimpse&#39; function</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="dplyr.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the `Survival`,` Pclass`, `Sex` and` Embarked` columns</span></span>
<span id="cb461-2"><a href="dplyr.html#cb461-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the `titanic` data frame into factors</span></span>
<span id="cb461-3"><a href="dplyr.html#cb461-3" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>Survived <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(titanic<span class="sc">$</span>Survived)</span>
<span id="cb461-4"><a href="dplyr.html#cb461-4" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>Pclass <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(titanic<span class="sc">$</span>Pclass)</span>
<span id="cb461-5"><a href="dplyr.html#cb461-5" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>Sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(titanic<span class="sc">$</span>Sex)</span>
<span id="cb461-6"><a href="dplyr.html#cb461-6" aria-hidden="true" tabindex="-1"></a>titanic<span class="sc">$</span>Embarked <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(titanic<span class="sc">$</span>Embarked)</span>
<span id="cb461-7"><a href="dplyr.html#cb461-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-8"><a href="dplyr.html#cb461-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-9"><a href="dplyr.html#cb461-9" aria-hidden="true" tabindex="-1"></a><span class="co"># briefly explore the `titanic` data frame</span></span>
<span id="cb461-10"><a href="dplyr.html#cb461-10" aria-hidden="true" tabindex="-1"></a><span class="co"># using the &#39;glimpse&#39; function</span></span>
<span id="cb461-11"><a href="dplyr.html#cb461-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(titanic)</span></code></pre></div>
<pre><code>## Rows: 891
## Columns: 12
## $ PassengerId &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
## $ Survived    &lt;fct&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1…
## $ Pclass      &lt;fct&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3, 2, 3, 3…
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bradley (Fl…
## $ Sex         &lt;fct&gt; male, female, female, female, male, male, male, male, fema…
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, 39, 14, …
## $ SibSp       &lt;dbl&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4, 0, 1, 0…
## $ Parch       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1, 0, 0, 0…
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;113803&quot;, &quot;37…
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, 51.8625,…
## $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, &quot;G6&quot;, &quot;C…
## $ Embarked    &lt;fct&gt; S, C, S, S, S, Q, S, S, S, C, S, S, S, S, S, S, Q, S, S, C…</code></pre>
</div>
<p>There is also a more concise way to factorizing columns which leverages the <code>lapply</code> function:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="dplyr.html#cb463-1" aria-hidden="true" tabindex="-1"></a>categories <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Survived&quot;</span>, <span class="st">&quot;Pclass&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Embarked&quot;</span>)</span>
<span id="cb463-2"><a href="dplyr.html#cb463-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-3"><a href="dplyr.html#cb463-3" aria-hidden="true" tabindex="-1"></a>titanic[categories] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(titanic[categories], as.factor)</span></code></pre></div>
<p>Now that we have a good understanding of our data set and have made the initial preparations in terms of column categorization, we can begin with the introduction of <code>dplyr</code> package functions.</p>
</div>
<div id="creating-a-subset-of-observations-with-filter-andslice" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Creating a subset of observations with <code>filter</code> and<code>slice</code><a href="dplyr.html#creating-a-subset-of-observations-with-filter-andslice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the chapter on data frames, we have already learned that “slicing” data frames can be done similar to slicing matrices - using index vectors to define which rows/columns are retained. We have also learned that index vectors can be numerical (location), logical, and character-typed.</p>
<p>When defining a subset of rows, by far the most common type of index vector is logical - with the help of variables, i.e. data frame columns, we define a specific criterion that “filters” the rows. Unfortunately, the basic <em>R</em> syntax of using logical index vectors to determine a subset of rows is somewhat clumsy, as can be seen from this example:</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="dplyr.html#cb464-1" aria-hidden="true" tabindex="-1"></a>df[df<span class="sc">$</span>a <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> df<span class="sc">$</span>b <span class="sc">!=</span> <span class="dv">3</span>,]</span></code></pre></div>
<p>The first and obvious issue is the need to repeat the name of the data frame (which we can eliminate with the help of the <code>attach</code> function, which we said was not an ideal solution because it brings a number of new potential problems). The second issue is the readability problem - the above command is not easy to interpret visually, that is, it is not easy to see immediately afte that it is an instruction which aims to reduce the number of rows in a data frame.</p>
<p>The alternative is to use the <code>filter</code> function from the package <code>dplyr</code> which uses explicitely indicates that it is filtering rows, and also allows the use of column names without having to reference the name of the data frame:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="dplyr.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, a <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> b <span class="sc">!=</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Also, it is good to note that the first argument of the function is the data frame itself, which allows us to easily chain it. Most of the <code>dplyr</code> package functions are designed on this principle.</p>
<p>The above function is the most common way to select a subset of rows (readers who are acquainted with the SQL language will notice a similarity to the WHERE segment of SQL queries). In addition to the <code>filter</code> function, to specify a subset of rows we want to keep we can also use some of the following functions, which also have very intuitive names (for easier interpretation rather than signature functions, we give examples of parameters):</p>
<ul>
<li><code>distinct(df)</code> - for removing duplicates</li>
<li><code>slice(df, 1:10)</code> - for location indexing</li>
<li><code>sample_frac(df, 0.2)</code> - random selection of a certain percentage of rows</li>
<li><code>sample_n(df, 50)</code> - randomly select of a specific number of rows</li>
<li><code>top_n(df, 10, a)</code> - returns the first 10 rows, ordered by the values of attribute <code>a</code></li>
</ul>
<p>We can use the following to rearrange the rows in the result:</p>
<ul>
<li><code>arrange(df, a, desc(b))</code> - sort by column <code>a</code> in ascending order and then by <code>b</code> in descending order</li>
</ul>
<p>Let’s try this in the following examples:</p>
<hr />
<p><strong>Exercise 11.3 - row selection</strong></p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="dplyr.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about all first class passengers over 60 years of age</span></span>
<span id="cb466-2"><a href="dplyr.html#cb466-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-3"><a href="dplyr.html#cb466-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about all surviving male travelers who</span></span>
<span id="cb466-4"><a href="dplyr.html#cb466-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have `George` or` Frank` in their name</span></span>
<span id="cb466-5"><a href="dplyr.html#cb466-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-6"><a href="dplyr.html#cb466-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the dataset contains duplicate observations</span></span>
<span id="cb466-7"><a href="dplyr.html#cb466-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-8"><a href="dplyr.html#cb466-8" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly select and print information about five passengers who</span></span>
<span id="cb466-9"><a href="dplyr.html#cb466-9" aria-hidden="true" tabindex="-1"></a><span class="co"># have not survived the sinking</span></span>
<span id="cb466-10"><a href="dplyr.html#cb466-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print order in descending order of ticket price</span></span>
<span id="cb466-11"><a href="dplyr.html#cb466-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-12"><a href="dplyr.html#cb466-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about the five oldest first class passengers</span></span>
<span id="cb466-13"><a href="dplyr.html#cb466-13" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange the result in ascending order of age</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="dplyr.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about all first class passengers over 60 years of age</span></span>
<span id="cb467-2"><a href="dplyr.html#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(titanic, Pclass <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Age<span class="sc">&gt;</span> <span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 14 × 12
##    PassengerId Survived Pclass Name   Sex     Age SibSp Parch Ticket  Fare Cabin
##          &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;  &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
##  1          55 0        1      Ostby… male     65     0     1 113509  62.0 B30  
##  2          97 0        1      Golds… male     71     0     0 PC 17…  34.7 A5   
##  3         171 0        1      Van d… male     61     0     0 111240  33.5 B19  
##  4         253 0        1      Stead… male     62     0     0 113514  26.6 C87  
##  5         276 1        1      Andre… fema…    63     1     0 13502   78.0 D7   
##  6         439 0        1      Fortu… male     64     1     4 19950  263   C23 …
##  7         457 0        1      Mille… male     65     0     0 13509   26.6 E38  
##  8         494 0        1      Artag… male     71     0     0 PC 17…  49.5 &lt;NA&gt; 
##  9         546 0        1      Nicho… male     64     0     0 693     26   &lt;NA&gt; 
## 10         556 0        1      Wrigh… male     62     0     0 113807  26.6 &lt;NA&gt; 
## 11         626 0        1      Sutto… male     61     0     0 36963   32.3 D50  
## 12         631 1        1      Barkw… male     80     0     0 27042   30   A23  
## 13         746 0        1      Crosb… male     70     1     1 WE/P …  71   B22  
## 14         830 1        1      Stone… fema…    62     0     0 113572  80   B28  
## # … with 1 more variable: Embarked &lt;fct&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="dplyr.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about all surviving male travelers who</span></span>
<span id="cb469-2"><a href="dplyr.html#cb469-2" aria-hidden="true" tabindex="-1"></a><span class="co"># have `George` or` Frank` in their name</span></span>
<span id="cb469-3"><a href="dplyr.html#cb469-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(titanic, <span class="fu">str_detect</span>(Name, <span class="st">&quot;(George|Frank)&quot;</span>) <span class="sc">&amp;</span> Sex <span class="sc">==</span> <span class="st">&quot;male&quot;</span> <span class="sc">&amp;</span> Survived <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
##   PassengerId Survived Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin
##         &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
## 1         166 1        3      &quot;Golds… male   9        0     2 363291  20.5 &lt;NA&gt; 
## 2         371 1        1      &quot;Harde… male  25        1     0 11765   55.4 E50  
## 3         508 1        1      &quot;Bradl… male  NA        0     0 111427  26.6 &lt;NA&gt; 
## 4         571 1        2      &quot;Harri… male  62        0     0 S.W./…  10.5 &lt;NA&gt; 
## 5         710 1        3      &quot;Mouba… male  NA        1     1 2661    15.2 &lt;NA&gt; 
## 6         832 1        2      &quot;Richa… male   0.83     1     1 29106   18.8 &lt;NA&gt; 
## # … with 1 more variable: Embarked &lt;fct&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="dplyr.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether the dataset contains duplicate observations</span></span>
<span id="cb471-2"><a href="dplyr.html#cb471-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(titanic) <span class="sc">==</span> <span class="fu">nrow</span>(<span class="fu">distinct</span>(titanic))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="dplyr.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly select and print information about five passengers who</span></span>
<span id="cb473-2"><a href="dplyr.html#cb473-2" aria-hidden="true" tabindex="-1"></a><span class="co"># have not survived the sinking</span></span>
<span id="cb473-3"><a href="dplyr.html#cb473-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print order in descending order of ticket price</span></span>
<span id="cb473-4"><a href="dplyr.html#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(titanic, Survived <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Fare))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 12
##   PassengerId Survived Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin
##         &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
## 1          51 0        3      Panula… male    7       4     1 31012… 39.7  &lt;NA&gt; 
## 2         552 0        2      Sharp,… male   27       0     0 244358 26    &lt;NA&gt; 
## 3         151 0        2      Batema… male   51       0     0 S.O.P… 12.5  &lt;NA&gt; 
## 4         336 0        3      Denkof… male   NA       0     0 349225  7.90 &lt;NA&gt; 
## 5         768 0        3      Mangan… fema…  30.5     0     0 364850  7.75 &lt;NA&gt; 
## # … with 1 more variable: Embarked &lt;fct&gt;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="dplyr.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print information about the five oldest first class passengers</span></span>
<span id="cb475-2"><a href="dplyr.html#cb475-2" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange the result in ascending order of age</span></span>
<span id="cb475-3"><a href="dplyr.html#cb475-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(titanic, Pclass <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Sex <span class="sc">==</span> <span class="st">&quot;female&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="dv">5</span>, Age) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Age)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 12
##   PassengerId Survived Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin
##         &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
## 1          12 1        1      Bonnel… fema…    58     0     0 113783  26.6 C103 
## 2         196 1        1      Lurett… fema…    58     0     0 PC 17… 147.  B80  
## 3         269 1        1      Graham… fema…    58     0     1 PC 17… 153.  C125 
## 4         367 1        1      Warren… fema…    60     1     0 110813  75.2 D37  
## 5         830 1        1      Stone,… fema…    62     0     0 113572  80   B28  
## 6         276 1        1      Andrew… fema…    63     1     0 13502   78.0 D7   
## # … with 1 more variable: Embarked &lt;fct&gt;</code></pre>
</div>
<hr />
<p>Notice that the <code>top_n</code> function returns the “first n” rows but does not necessarily arrange them in that order. If we want them arranged we also need to use the <code>arrange</code> function.</p>
</div>
<div id="creating-a-subset-of-columns-with-select" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Creating a subset of columns with <code>select</code><a href="dplyr.html#creating-a-subset-of-columns-with-select" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another method of slixing a data frame selecting a subset of columns. Unlike selecting a subset of rows, where we most often use logical indexing, columns or variables are most often referenced by their name. The syntax for selecting a subset of columns by name using the basic indexing method in <em>R</em> looks like this:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="dplyr.html#cb477-1" aria-hidden="true" tabindex="-1"></a>df[, <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)]</span></code></pre></div>
<p>Here we also notice a certain clumsiness in the syntax and difficulty in interpretation. Column names must be wrapped in a <code>c</code> function, which reduces readability, and the command doesn’t explicitly state that it is selecting columns of the data frame, we have to conclude it from the position of the index vector. In addition, there is no easy way to select a range of columns by name, the existence of a substring or pattern within the name, etc.</p>
<p>The <code>select</code> function allows us to explicitly select columns using syntax:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="dplyr.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(df, a, b, c)</span></code></pre></div>
<p>So we simply list the data frame and the row of columns we want to select. It is also notice the similarity to SQL, specifically the SELECT part of SQL queries.</p>
<p>But the above syntax is not all that this feature has to offer - <code>select</code> has a number of helper functions and operators that greatly extend its functionality, such as:</p>
<ul>
<li><code>select(df, a:c)</code> - select columns from <code>a</code> to<code>c</code></li>
<li><code>select(df, -a, -b)</code> - select all columns except <code>a</code> and<code>b</code></li>
<li><code>select(df, starts_with("PO")))</code> - select columns beginning with the letters <code>"PO"</code></li>
<li><code>select(df, contains("col"))</code> - select columns containing the letters<code>"col"</code></li>
<li><code>select(df, matches("[123]{2,3}"))</code> - select columns that match the given regular expression</li>
</ul>
<p>Additional options are easy to find in the official documentation.</p>
<p>Let’s try this command, also on our dataset.</p>
<hr />
<p><strong>Exercise 11.4 - selecting the columns</strong></p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="dplyr.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for randomly selected 10 rows, print the passenger&#39;s name, age and</span></span>
<span id="cb479-2"><a href="dplyr.html#cb479-2" aria-hidden="true" tabindex="-1"></a><span class="co"># whether he survived the sinking or not</span></span>
<span id="cb479-3"><a href="dplyr.html#cb479-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-4"><a href="dplyr.html#cb479-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for the 10 oldest passengers, print all attributes from name to ticket price</span></span>
<span id="cb479-5"><a href="dplyr.html#cb479-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-6"><a href="dplyr.html#cb479-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print all attributes except for the identifier and cabin number</span></span>
<span id="cb479-7"><a href="dplyr.html#cb479-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for a randomly selected 1% of rows</span></span>
<span id="cb479-8"><a href="dplyr.html#cb479-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-9"><a href="dplyr.html#cb479-9" aria-hidden="true" tabindex="-1"></a><span class="co"># for rows from number 10 to number 20, print out all columns beginning with a vowel</span></span>
<span id="cb479-10"><a href="dplyr.html#cb479-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-11"><a href="dplyr.html#cb479-11" aria-hidden="true" tabindex="-1"></a><span class="co"># for randomly selected 10 passengers whose age is unknown, print all</span></span>
<span id="cb479-12"><a href="dplyr.html#cb479-12" aria-hidden="true" tabindex="-1"></a><span class="co"># attributes from name to ticket price, then the passenger class </span></span>
<span id="cb479-13"><a href="dplyr.html#cb479-13" aria-hidden="true" tabindex="-1"></a><span class="co"># and finally whether or not the passenger survived</span></span>
<span id="cb479-14"><a href="dplyr.html#cb479-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the rows alphabetically by name</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="dplyr.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for randomly selected 10 rows, print the passenger&#39;s name, age and</span></span>
<span id="cb480-2"><a href="dplyr.html#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="co"># whether he survived the sinking or not</span></span>
<span id="cb480-3"><a href="dplyr.html#cb480-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(titanic, <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Name, Age, Survived)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    Name                                    Age Survived
##    &lt;chr&gt;                                 &lt;dbl&gt; &lt;fct&gt;   
##  1 Millet, Mr. Francis Davis              65   0       
##  2 Wilhelms, Mr. Charles                  31   1       
##  3 Davis, Miss. Mary                      28   1       
##  4 Brocklebank, Mr. William Alfred        35   0       
##  5 Lindahl, Miss. Agda Thorilda Viktoria  25   0       
##  6 Vande Walle, Mr. Nestor Cyriel         28   0       
##  7 Nosworthy, Mr. Richard Cater           21   0       
##  8 Artagaveytia, Mr. Ramon                71   0       
##  9 Youseff, Mr. Gerious                   45.5 0       
## 10 Bryhl, Mr. Kurt Arnold Gottfrid        25   0</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="dplyr.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the 10 oldest passengers, print all attributes from name to ticket price</span></span>
<span id="cb482-2"><a href="dplyr.html#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">top_n</span>(titanic, <span class="dv">10</span>, Age) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Name<span class="sc">:</span>Fare)</span></code></pre></div>
<pre><code>## # A tibble: 11 × 7
##    Name                                 Sex     Age SibSp Parch Ticket      Fare
##    &lt;chr&gt;                                &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 Wheadon, Mr. Edward H                male   66       0     0 C.A. 24579 10.5 
##  2 Ostby, Mr. Engelhart Cornelius       male   65       0     1 113509     62.0 
##  3 Goldschmidt, Mr. George B            male   71       0     0 PC 17754   34.7 
##  4 Connors, Mr. Patrick                 male   70.5     0     0 370369      7.75
##  5 Duane, Mr. Frank                     male   65       0     0 336439      7.75
##  6 Millet, Mr. Francis Davis            male   65       0     0 13509      26.6 
##  7 Artagaveytia, Mr. Ramon              male   71       0     0 PC 17609   49.5 
##  8 Barkworth, Mr. Algernon Henry Wilson male   80       0     0 27042      30   
##  9 Mitchell, Mr. Henry Michael          male   70       0     0 C.A. 24580 10.5 
## 10 Crosby, Capt. Edward Gifford         male   70       1     1 WE/P 5735  71   
## 11 Svensson, Mr. Johan                  male   74       0     0 347060      7.78</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="dplyr.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print all attributes except for the identifier and cabin number</span></span>
<span id="cb484-2"><a href="dplyr.html#cb484-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for a randomly selected 1% of rows</span></span>
<span id="cb484-3"><a href="dplyr.html#cb484-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_frac</span>(titanic, <span class="fl">0.01</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>PassengerId, <span class="sc">-</span>Cabin)</span></code></pre></div>
<pre><code>## # A tibble: 9 × 10
##   Survived Pclass Name             Sex     Age SibSp Parch Ticket  Fare Embarked
##   &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;            &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;fct&gt;   
## 1 0        3      Cacic, Mr. Luka  male     38     0     0 315089  8.66 S       
## 2 1        2      Shelley, Mrs. W… fema…    25     0     1 230433 26    S       
## 3 0        3      Lefebre, Miss. … fema…    NA     3     1 4133   25.5  S       
## 4 0        3      Tobin, Mr. Roger male     NA     0     0 383121  7.75 Q       
## 5 0        3      Dean, Mr. Bertr… male     26     1     2 C.A. … 20.6  S       
## 6 0        3      Skoog, Miss. Ma… fema…     2     3     2 347088 27.9  S       
## 7 0        2      Moraweck, Dr. E… male     54     0     0 29011  14    S       
## 8 0        3      Nysveen, Mr. Jo… male     61     0     0 345364  6.24 S       
## 9 0        3      Braund, Mr. Owe… male     22     1     0 A/5 2…  7.25 S</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="dplyr.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for rows from number 10 to number 20, print out all columns beginning with a vowel</span></span>
<span id="cb486-2"><a href="dplyr.html#cb486-2" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(titanic, <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;^[AEIOUaeiou]&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 11 × 2
##      Age Embarked
##    &lt;dbl&gt; &lt;fct&gt;   
##  1    14 C       
##  2     4 S       
##  3    58 S       
##  4    20 S       
##  5    39 S       
##  6    14 S       
##  7    55 S       
##  8     2 Q       
##  9    NA S       
## 10    31 S       
## 11    NA C</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="dplyr.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for randomly selected 10 passengers whose age is unknown, print all</span></span>
<span id="cb488-2"><a href="dplyr.html#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="co"># attributes from name to ticket price, then the passenger class </span></span>
<span id="cb488-3"><a href="dplyr.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and finally whether or not the passenger survived</span></span>
<span id="cb488-4"><a href="dplyr.html#cb488-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the rows alphabetically by name</span></span>
<span id="cb488-5"><a href="dplyr.html#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(titanic, <span class="fu">is.na</span>(Age)) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb488-6"><a href="dplyr.html#cb488-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name<span class="sc">:</span>Fare, Pclass, Survived) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Name)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 9
##    Name                    Sex     Age SibSp Parch Ticket   Fare Pclass Survived
##    &lt;chr&gt;                   &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;   
##  1 Farthing, Mr. John      male     NA     0     0 PC 17… 222.   1      0       
##  2 Garfirth, Mr. John      male     NA     0     0 358585  14.5  3      0       
##  3 Harrington, Mr. Charle… male     NA     0     0 113796  42.4  1      0       
##  4 Mitkoff, Mr. Mito       male     NA     0     0 349221   7.90 3      0       
##  5 Moore, Mr. Leonard Cha… male     NA     0     0 A4. 5…   8.05 3      0       
##  6 Moran, Mr. James        male     NA     0     0 330877   8.46 3      0       
##  7 Paulner, Mr. Uscher     male     NA     0     0 3411     8.71 3      0       
##  8 Peter, Miss. Anna       fema…    NA     1     1 2668    22.4  3      1       
##  9 Saalfeld, Mr. Adolphe   male     NA     0     0 19988   30.5  1      1       
## 10 Sadlier, Mr. Matthew    male     NA     0     0 367655   7.73 3      0</code></pre>
</div>
<hr />
</div>
<div id="creating-new-columns-with-mutate" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Creating new columns with <code>mutate</code><a href="dplyr.html#creating-new-columns-with-mutate" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When working with datasets, there is often a need to create additional variables with the help of information stored in one or more existing variables. Most often, we create a new column using an expression that describes how we transform existing data; motivation can be the normalization of a numerical variable, the creation of an indicator or categorical variable, the summation of multiple variables into one single variable, or any other transformation in order to obtain a new variable that is in some way required for the further steps of the analysis process.</p>
<p>Assuming that we want to create a new column that stores the sum of two numerical values of the existing columns, then the base <em>R</em> syntax might look as follows:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="dplyr.html#cb490-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c <span class="ot">&lt;-</span> df<span class="sc">$</span>a <span class="sc">+</span> df<span class="sc">$</span>b</span></code></pre></div>
<p>The <code>dplyr</code> package offers us an alternative in the form of<code>mutate</code> and <code>transmute</code> functions:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="dplyr.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(df, <span class="at">c =</span> a <span class="sc">+</span> b)</span>
<span id="cb491-2"><a href="dplyr.html#cb491-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-3"><a href="dplyr.html#cb491-3" aria-hidden="true" tabindex="-1"></a><span class="fu">transmute</span>(df, <span class="at">c =</span> a <span class="sc">+</span> b)</span></code></pre></div>
<p>Difference between these two function is that <code>mutate</code> returns the entire original data frame with newly created columns, while <code>transmute</code> retains only the columns specified inside the function call. Therefore, we can use <code>transmute</code> as a shortened combination of <code>mutate</code> and <code>select</code>:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="dplyr.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transmute</span>(df, a, <span class="at">c =</span> a <span class="sc">+</span> b)</span>
<span id="cb492-2"><a href="dplyr.html#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="co"># same as mutate(df, c = a + b) %&gt;% select(a, c)</span></span></code></pre></div>
<p>(NOTE: We don’t have to necessarily expect a degradation of peformance here as a result of copying data frames, since <em>R</em> does a “shallow copy” when adding a column, that is, a new data frame only references a new column while retaining references to the remaining columns. If we were creating a “deep copy”, i.e. if we were copying all columns into the new frame, which would make this operation “expensive” when it comes to processing)</p>
<p>Note that <code>mutate</code> and<code>transmute</code> are not alternatives to the <em>UPDATE</em> command from <em>SQL</em>, but rather correspond to the expressions used in the <em>SELECT</em> [segment of the command in scenarios when we do not select individual columns but combine them as part of an expression part of the SQL <em>query</em>.</p>
<p>The <code>mutate</code> and <code>transmute</code> functions use common (vectorized) functions and operators, but we also have a number of additional so-called “window” functions that give us additional flexibility when creating new variables, such as:</p>
<ul>
<li><code>ntile</code>,<code>cut</code> - for transforming a numerical column into a categorical; <code>ntile</code> will make categories of the same size, while <code>cut</code> will cut the range in equally sized intervals</li>
<li><code>dense_rank</code>,<code>min_rank</code> - for ranking of observations (the difference is only in handling observations with the same values)</li>
<li><code>between</code> - for creating an indicator column explaining whether a given variable is in the interval given by two other columns</li>
<li><code>pmin</code>,<code>pmax</code> - “parallel minimum and maximum”, ie the minimum or maximum values of the selected columns viewed by individual rows</li>
<li>etc.</li>
</ul>
<p>A list of all available functions can be found in the documentation.</p>
<hr />
<p><strong>Exercise 11.5 - creating new columns</strong></p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="dplyr.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a `hadRelativesOnBoard` logical column to the` titanic` table which </span></span>
<span id="cb493-2"><a href="dplyr.html#cb493-2" aria-hidden="true" tabindex="-1"></a><span class="co"># describes whether the passenger had relatives on board</span></span>
<span id="cb493-3"><a href="dplyr.html#cb493-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-4"><a href="dplyr.html#cb493-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-5"><a href="dplyr.html#cb493-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for randomly selected 10 passengers over the age of 20 who boarded in Southampton</span></span>
<span id="cb493-6"><a href="dplyr.html#cb493-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print out passenger&#39;s name, travel class, and transformed ticket price</span></span>
<span id="cb493-7"><a href="dplyr.html#cb493-7" aria-hidden="true" tabindex="-1"></a><span class="co"># replace the ticket price with what it would cost today</span></span>
<span id="cb493-8"><a href="dplyr.html#cb493-8" aria-hidden="true" tabindex="-1"></a><span class="co"># (assume $1 of 1912 equals $23.85 today, calculating in the inflation)</span></span>
<span id="cb493-9"><a href="dplyr.html#cb493-9" aria-hidden="true" tabindex="-1"></a><span class="co"># call the new column `FareToday` </span></span>
<span id="cb493-10"><a href="dplyr.html#cb493-10" aria-hidden="true" tabindex="-1"></a><span class="co"># round the amount to two decimal places and add the prefix `$`</span></span>
<span id="cb493-11"><a href="dplyr.html#cb493-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the result by passenger class in descending order</span></span>
<span id="cb493-12"><a href="dplyr.html#cb493-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-13"><a href="dplyr.html#cb493-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-14"><a href="dplyr.html#cb493-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create a `FareCategory` column which puts the ticket prices</span></span>
<span id="cb493-15"><a href="dplyr.html#cb493-15" aria-hidden="true" tabindex="-1"></a><span class="co"># into five equally sized categories</span></span>
<span id="cb493-16"><a href="dplyr.html#cb493-16" aria-hidden="true" tabindex="-1"></a><span class="co"># then randomly select 20 passengers and print</span></span>
<span id="cb493-17"><a href="dplyr.html#cb493-17" aria-hidden="true" tabindex="-1"></a><span class="co"># passenger name, travel class, ticket price and category</span></span>
<span id="cb493-18"><a href="dplyr.html#cb493-18" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the result by price category</span></span>
<span id="cb493-19"><a href="dplyr.html#cb493-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-20"><a href="dplyr.html#cb493-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-21"><a href="dplyr.html#cb493-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add an `EmbarkationPort` column to the `titanic` table, which will contain</span></span>
<span id="cb493-22"><a href="dplyr.html#cb493-22" aria-hidden="true" tabindex="-1"></a><span class="co"># the full name of the port of embarkation (Southampton, Queenstown or Cherbourg)</span></span>
<span id="cb493-23"><a href="dplyr.html#cb493-23" aria-hidden="true" tabindex="-1"></a><span class="co"># use `mutate` and two `ifelse` functions</span></span>
<span id="cb493-24"><a href="dplyr.html#cb493-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-25"><a href="dplyr.html#cb493-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb493-26"><a href="dplyr.html#cb493-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print the first 10 rows of the `titanic` table</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="dplyr.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a `hadRelativesOnBoard` logical column to the` titanic` table which </span></span>
<span id="cb494-2"><a href="dplyr.html#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="co"># describes whether the passenger had relatives on board</span></span>
<span id="cb494-3"><a href="dplyr.html#cb494-3" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">mutate</span>(titanic, <span class="at">hadRelativesOnBoard =</span> SibSp<span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> Parch<span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="dplyr.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for randomly selected 10 passengers over the age of 20 who boarded in Southampton</span></span>
<span id="cb495-2"><a href="dplyr.html#cb495-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print out passenger&#39;s name, travel class, and transformed ticket price</span></span>
<span id="cb495-3"><a href="dplyr.html#cb495-3" aria-hidden="true" tabindex="-1"></a><span class="co"># replace the ticket price with what it would cost today</span></span>
<span id="cb495-4"><a href="dplyr.html#cb495-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (assume $1 of 1912 equals $23.85 today, calculating in the inflation)</span></span>
<span id="cb495-5"><a href="dplyr.html#cb495-5" aria-hidden="true" tabindex="-1"></a><span class="co"># call the new column `FareToday` </span></span>
<span id="cb495-6"><a href="dplyr.html#cb495-6" aria-hidden="true" tabindex="-1"></a><span class="co"># round the amount to two decimal places and add the prefix `$`</span></span>
<span id="cb495-7"><a href="dplyr.html#cb495-7" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the result by passenger class in descending order</span></span>
<span id="cb495-8"><a href="dplyr.html#cb495-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(titanic, Sex <span class="sc">==</span> <span class="st">&#39;female&#39;</span>, Age<span class="sc">&gt;</span> <span class="dv">20</span>, Embarked <span class="sc">==</span> <span class="st">&#39;S&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb495-9"><a href="dplyr.html#cb495-9" aria-hidden="true" tabindex="-1"></a><span class="fu">transmute</span>(Name, Pclass, <span class="at">FareToday =</span> <span class="fu">str_c</span>(<span class="st">&quot;$&quot;</span>, <span class="fu">round</span>(Fare <span class="sc">*</span> <span class="fl">23.85</span>, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Pclass))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    Name                                                      Pclass FareToday
##    &lt;chr&gt;                                                     &lt;fct&gt;  &lt;chr&gt;    
##  1 Asplund, Mrs. Carl Oscar (Selma Augusta Emilia Johansson) 3      $748.59  
##  2 Andersson, Mrs. Anders Johan (Alfrida Konstantia Brogren) 3      $745.91  
##  3 Lahtinen, Mrs. William (Anna Sylfven)                     2      $620.1   
##  4 Ball, Mrs. (Ada E Hall)                                   2      $310.05  
##  5 Mack, Mrs. (Mary)                                         2      $250.43  
##  6 Swift, Mrs. Frederick Joel (Margaret Welles Barron)       1      $618.41  
##  7 Shutes, Miss. Elizabeth W                                 1      $3660.08 
##  8 Perreault, Miss. Anne                                     1      $2229.98 
##  9 Hogeboom, Mrs. John C (Anna Andrews)                      1      $1859.31 
## 10 Robert, Mrs. Edward Scott (Elisabeth Walton McMillan)     1      $5040.4</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="dplyr.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a `FareCategory` column which puts the ticket prices</span></span>
<span id="cb497-2"><a href="dplyr.html#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="co"># into five equally sized categories</span></span>
<span id="cb497-3"><a href="dplyr.html#cb497-3" aria-hidden="true" tabindex="-1"></a><span class="co"># then randomly select 20 passengers and print</span></span>
<span id="cb497-4"><a href="dplyr.html#cb497-4" aria-hidden="true" tabindex="-1"></a><span class="co"># passenger name, travel class, ticket price and category</span></span>
<span id="cb497-5"><a href="dplyr.html#cb497-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the result by price category</span></span>
<span id="cb497-6"><a href="dplyr.html#cb497-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(titanic, <span class="at">FareCategory =</span> <span class="fu">ntile</span>(Fare, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb497-7"><a href="dplyr.html#cb497-7" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(Name, Pclass, Fare, FareCategory) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(FareCategory)</span></code></pre></div>
<pre><code>## # A tibble: 20 × 4
##    Name                                               Pclass   Fare FareCategory
##    &lt;chr&gt;                                              &lt;fct&gt;   &lt;dbl&gt;        &lt;int&gt;
##  1 &quot;Carlsson, Mr. August Sigfrid&quot;                     3        7.80            1
##  2 &quot;Coelho, Mr. Domingos Fernandeo&quot;                   3        7.05            1
##  3 &quot;Parkes, Mr. Francis \&quot;Frank\&quot;&quot;                    2        0               1
##  4 &quot;Attalah, Mr. Sleiman&quot;                             3        7.22            1
##  5 &quot;Rogers, Mr. William John&quot;                         3        8.05            2
##  6 &quot;Harris, Mr. George&quot;                               2       10.5             2
##  7 &quot;Kraeff, Mr. Theodor&quot;                              3        7.90            2
##  8 &quot;Moore, Mr. Leonard Charles&quot;                       3        8.05            2
##  9 &quot;Hamalainen, Master. Viljo&quot;                        2       14.5             3
## 10 &quot;Panula, Master. Eino Viljami&quot;                     3       39.7             4
## 11 &quot;Andersson, Mr. Anders Johan&quot;                      3       31.3             4
## 12 &quot;Hart, Miss. Eva Miriam&quot;                           2       26.2             4
## 13 &quot;Smith, Mr. James Clinch&quot;                          1       30.7             4
## 14 &quot;Blank, Mr. Henry&quot;                                 1       31               4
## 15 &quot;Chibnall, Mrs. (Edith Martha Bowerman)&quot;           1       55               5
## 16 &quot;Robbins, Mr. Victor&quot;                              1      228.              5
## 17 &quot;Maioni, Miss. Roberta&quot;                            1       86.5             5
## 18 &quot;Warren, Mrs. Frank Manley (Anna Sophia Atkinson)&quot; 1       75.2             5
## 19 &quot;Chaffee, Mr. Herbert Fuller&quot;                      1       61.2             5
## 20 &quot;Fortune, Miss. Mabel Helen&quot;                       1      263               5</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="dplyr.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add an `EmbarkationPort` column to the `titanic` table, which will contain</span></span>
<span id="cb499-2"><a href="dplyr.html#cb499-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the full name of the port of embarkation (Southampton, Queenstown or Cherbourg)</span></span>
<span id="cb499-3"><a href="dplyr.html#cb499-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use `mutate` and two `ifelse` functions</span></span>
<span id="cb499-4"><a href="dplyr.html#cb499-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(titanic, <span class="at">EmbarkationPort =</span> <span class="fu">ifelse</span>(Embarked <span class="sc">==</span> <span class="st">&#39;S&#39;</span>, <span class="st">&#39;Southampton&#39;</span>,</span>
<span id="cb499-5"><a href="dplyr.html#cb499-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ifelse</span>(Embarked <span class="sc">==</span> <span class="st">&#39;C&#39;</span>, <span class="st">&#39;Cherbourg&#39;</span>, <span class="st">&#39;Queenstown&#39;</span>))) <span class="ot">-&gt;</span> titanic</span>
<span id="cb499-6"><a href="dplyr.html#cb499-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-7"><a href="dplyr.html#cb499-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print the first 10 rows of the `titanic` table</span></span>
<span id="cb499-8"><a href="dplyr.html#cb499-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 14
##    PassengerId Survived Pclass Name   Sex     Age SibSp Parch Ticket  Fare Cabin
##          &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;chr&gt;  &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;
##  1           1 0        3      Braun… male     22     1     0 A/5 2…  7.25 &lt;NA&gt; 
##  2           2 1        1      Cumin… fema…    38     1     0 PC 17… 71.3  C85  
##  3           3 1        3      Heikk… fema…    26     0     0 STON/…  7.92 &lt;NA&gt; 
##  4           4 1        1      Futre… fema…    35     1     0 113803 53.1  C123 
##  5           5 0        3      Allen… male     35     0     0 373450  8.05 &lt;NA&gt; 
##  6           6 0        3      Moran… male     NA     0     0 330877  8.46 &lt;NA&gt; 
##  7           7 0        1      McCar… male     54     0     0 17463  51.9  E46  
##  8           8 0        3      Palss… male      2     3     1 349909 21.1  &lt;NA&gt; 
##  9           9 1        3      Johns… fema…    27     0     2 347742 11.1  &lt;NA&gt; 
## 10          10 1        2      Nasse… fema…    14     1     0 237736 30.1  &lt;NA&gt; 
## # … with 3 more variables: Embarked &lt;fct&gt;, hadRelativesOnBoard &lt;lgl&gt;,
## #   EmbarkationPort &lt;chr&gt;</code></pre>
</div>
</div>
<div id="sample-dataset-houston-flights" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Sample Dataset: <em>Houston flights</em><a href="dplyr.html#sample-dataset-houston-flights" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s now load the <code>hflights</code> data frame, which is in a package of the same name and can be retrieved from the CRAN repository. After loading the package, we can move the data frame to the global environment with the help of the <code>data</code> function.</p>
<hr />
<p><strong>Exercise 11.6 - dataset <code>hflights</code></strong></p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="dplyr.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the `hflights` package</span></span>
<span id="cb501-2"><a href="dplyr.html#cb501-2" aria-hidden="true" tabindex="-1"></a><span class="co"># if necessary install it from the CRAN repository</span></span>
<span id="cb501-3"><a href="dplyr.html#cb501-3" aria-hidden="true" tabindex="-1"></a><span class="co"># put the `hflights` data frame in the global environment using the `data` function</span></span>
<span id="cb501-4"><a href="dplyr.html#cb501-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-5"><a href="dplyr.html#cb501-5" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the frame to `hflights` into a &#39;tibble&#39;</span></span>
<span id="cb501-6"><a href="dplyr.html#cb501-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-7"><a href="dplyr.html#cb501-7" aria-hidden="true" tabindex="-1"></a><span class="co"># briefly explore the `hflights` dataset</span></span>
<span id="cb501-8"><a href="dplyr.html#cb501-8" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also check the documentation with the help of command `?hflights`</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="dplyr.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;hflights&quot;)  #if necessary</span></span>
<span id="cb502-2"><a href="dplyr.html#cb502-2" aria-hidden="true" tabindex="-1"></a><span class="co">#library(dplyr) # if not already loaded</span></span>
<span id="cb502-3"><a href="dplyr.html#cb502-3" aria-hidden="true" tabindex="-1"></a><span class="co">#library(hflights)</span></span>
<span id="cb502-4"><a href="dplyr.html#cb502-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(hflights)</span>
<span id="cb502-5"><a href="dplyr.html#cb502-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-6"><a href="dplyr.html#cb502-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the frame to `hflights` in &#39;tibble&#39;</span></span>
<span id="cb502-7"><a href="dplyr.html#cb502-7" aria-hidden="true" tabindex="-1"></a>hflights <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(hflights)</span>
<span id="cb502-8"><a href="dplyr.html#cb502-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-9"><a href="dplyr.html#cb502-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hflights)</span>
<span id="cb502-10"><a href="dplyr.html#cb502-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hflights)</span></code></pre></div>
<pre><code>## Rows: 227,496
## Columns: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011…
## $ Month             &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ DayofMonth        &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…
## $ DayOfWeek         &lt;int&gt; 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1, 2…
## $ DepTime           &lt;int&gt; 1400, 1401, 1352, 1403, 1405, 1359, 1359, 1355, 1443…
## $ ArrTime           &lt;int&gt; 1500, 1501, 1502, 1513, 1507, 1503, 1509, 1454, 1554…
## $ UniqueCarrier     &lt;chr&gt; &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;, &quot;AA&quot;…
## $ FlightNum         &lt;int&gt; 428, 428, 428, 428, 428, 428, 428, 428, 428, 428, 42…
## $ TailNum           &lt;chr&gt; &quot;N576AA&quot;, &quot;N557AA&quot;, &quot;N541AA&quot;, &quot;N403AA&quot;, &quot;N492AA&quot;, &quot;N…
## $ ActualElapsedTime &lt;int&gt; 60, 60, 70, 70, 62, 64, 70, 59, 71, 70, 70, 56, 63, …
## $ AirTime           &lt;int&gt; 40, 45, 48, 39, 44, 45, 43, 40, 41, 45, 42, 41, 44, …
## $ ArrDelay          &lt;int&gt; -10, -9, -8, 3, -3, -7, -1, -16, 44, 43, 29, 5, -9, …
## $ DepDelay          &lt;int&gt; 0, 1, -8, 3, 5, -1, -1, -5, 43, 43, 29, 19, -2, -3, …
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IA…
## $ Dest              &lt;chr&gt; &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DFW&quot;, &quot;DF…
## $ Distance          &lt;int&gt; 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 22…
## $ TaxiIn            &lt;int&gt; 7, 6, 5, 9, 9, 6, 12, 7, 8, 6, 8, 4, 6, 5, 6, 12, 8,…
## $ TaxiOut           &lt;int&gt; 13, 9, 17, 22, 9, 13, 15, 12, 22, 19, 20, 11, 13, 15…
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, …
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## # A tibble: 6 × 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     1          1         6    1400    1500 AA                  428
## 2  2011     1          2         7    1401    1501 AA                  428
## 3  2011     1          3         1    1352    1502 AA                  428
## 4  2011     1          4         2    1403    1513 AA                  428
## 5  2011     1          5         3    1405    1507 AA                  428
## 6  2011     1          6         4    1359    1503 AA                  428
## # … with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;,
## #   Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;,
## #   CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
</div>
<div id="grouping-and-aggregation-with-group_by-andsummarise" class="section level2 hasAnchor" number="11.7">
<h2><span class="header-section-number">11.7</span> Grouping and aggregation with <code>group_by</code> and<code>summarise</code><a href="dplyr.html#grouping-and-aggregation-with-group_by-andsummarise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the data analysis literature, we will often come across a so-called SAC paradigm (<em>Split-Apply-Combine</em>). It’s a strategy that comes down to breaking down a big task into smaller parts, doing some work on each part, and finally combining all the results into a single whole. The need for this paradigm is found in different analysis scenarios - in exploratory data analysis we will want to calculate different statistics or create new variables separately for different subsets of data (eg, depending on a category variable); When processing extremely large amounts of data, we often want to speed up the processing process by breaking the data into smaller sets that will each be processed separately (the well-known <em>Map-Reduce</em> principle).</p>
<p>Users of <em>SQL</em> will easily recognize this principle as grouping and aggregation, which are carried out through the <em>GROUP BY</em> segment of an <em>SQL</em> query with the accompanying elements in the <em>SELECT</em> part. The <code>dplyr</code> package offers very similar functionality (albeit in a procedural way) - we first perform “grouping”, i.e. create subsets of rows of a frame, and then carry out further processing in parallel over each subset, to collect all the results in a single dataframe.</p>
<p>For grouping, <code>dplyr</code> offers the<code>group_by</code> function, which converts a table (data frame) into a <code>grouped table (</code>grouped_tbl`):</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="dplyr.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(df, a, b, c)</span></code></pre></div>
<p>Let’s try this feature on our <code>hflights</code> data frame.</p>
<hr />
<p><strong>Exercise 11.7 - grouped table</strong></p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="dplyr.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a `flight815` variable that will contain rows from the `hflights` data frame</span></span>
<span id="cb505-2"><a href="dplyr.html#cb505-2" aria-hidden="true" tabindex="-1"></a><span class="co"># related to flight number 815</span></span>
<span id="cb505-3"><a href="dplyr.html#cb505-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-4"><a href="dplyr.html#cb505-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a `grouped815` variable that will contain rows from `flight815`</span></span>
<span id="cb505-5"><a href="dplyr.html#cb505-5" aria-hidden="true" tabindex="-1"></a><span class="co"># grouped by month</span></span>
<span id="cb505-6"><a href="dplyr.html#cb505-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-7"><a href="dplyr.html#cb505-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check the class of variables `flight815` and `grouped815`</span></span>
<span id="cb505-8"><a href="dplyr.html#cb505-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-9"><a href="dplyr.html#cb505-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb505-10"><a href="dplyr.html#cb505-10" aria-hidden="true" tabindex="-1"></a><span class="co"># briefly explore the `flight815` and `grouped815` variable structures </span></span>
<span id="cb505-11"><a href="dplyr.html#cb505-11" aria-hidden="true" tabindex="-1"></a><span class="co"># with the help of the `glimpse` function</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="dplyr.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a `flight815` variable that will contain rows from the `hflights` data frame</span></span>
<span id="cb506-2"><a href="dplyr.html#cb506-2" aria-hidden="true" tabindex="-1"></a><span class="co"># related to flight number 815</span></span>
<span id="cb506-3"><a href="dplyr.html#cb506-3" aria-hidden="true" tabindex="-1"></a>flight815 <span class="ot">&lt;-</span> <span class="fu">filter</span>(hflights, FlightNum <span class="sc">==</span> <span class="dv">815</span>)</span>
<span id="cb506-4"><a href="dplyr.html#cb506-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-5"><a href="dplyr.html#cb506-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create a `grouped815` variable that will contain rows from `flight815`</span></span>
<span id="cb506-6"><a href="dplyr.html#cb506-6" aria-hidden="true" tabindex="-1"></a><span class="co"># grouped by month</span></span>
<span id="cb506-7"><a href="dplyr.html#cb506-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-8"><a href="dplyr.html#cb506-8" aria-hidden="true" tabindex="-1"></a>grouped815 <span class="ot">&lt;-</span> <span class="fu">group_by</span>(flight815, Month)</span>
<span id="cb506-9"><a href="dplyr.html#cb506-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb506-10"><a href="dplyr.html#cb506-10" aria-hidden="true" tabindex="-1"></a><span class="co"># check the class of variables `flight815` and `grouped815`</span></span>
<span id="cb506-11"><a href="dplyr.html#cb506-11" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(flight815)</span>
<span id="cb506-12"><a href="dplyr.html#cb506-12" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(grouped815)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="dplyr.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="co"># briefly explore the `flight815` and `grouped815` variable structures </span></span>
<span id="cb508-2"><a href="dplyr.html#cb508-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with the help of the `glimpse` function</span></span>
<span id="cb508-3"><a href="dplyr.html#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(flight815)</span>
<span id="cb508-4"><a href="dplyr.html#cb508-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;------------------------&quot;</span>) <span class="co"># for more transparent printing on the console</span></span>
<span id="cb508-5"><a href="dplyr.html#cb508-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(grouped815)</span></code></pre></div>
<pre><code>## Rows: 95
## Columns: 21
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011…
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4…
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, …
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3…
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 2110, 2116…
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 2301, 2305…
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;…
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815, 815, 81…
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57868&quot;, &quot;N…
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229, 217, 23…
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186, 192, 18…
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33, 35, 4,…
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, 11, 3, -…
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IA…
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LA…
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 1379, 1379…
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, 15, 12, …
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, 18, 15, …
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, …
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## [1] &quot;------------------------&quot;
## Rows: 95
## Columns: 21
## Groups: Month [6]
## $ Year              &lt;int&gt; 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011, 2011…
## $ Month             &lt;int&gt; 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4…
## $ DayofMonth        &lt;int&gt; 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, …
## $ DayOfWeek         &lt;int&gt; 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3, 2, 1, 7, 6, 5, 4, 3…
## $ DepTime           &lt;int&gt; 2116, 2109, 2111, 2112, 2124, 2145, 2114, 2110, 2116…
## $ ArrTime           &lt;int&gt; 2255, 2252, 2255, 2326, 2321, 2327, 2324, 2301, 2305…
## $ UniqueCarrier     &lt;chr&gt; &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;, &quot;CO&quot;…
## $ FlightNum         &lt;int&gt; 815, 815, 815, 815, 815, 815, 815, 815, 815, 815, 81…
## $ TailNum           &lt;chr&gt; &quot;N74856&quot;, &quot;N57852&quot;, &quot;N78866&quot;, &quot;N57863&quot;, &quot;N57868&quot;, &quot;N…
## $ ActualElapsedTime &lt;int&gt; 219, 223, 224, 254, 237, 222, 250, 231, 229, 217, 23…
## $ AirTime           &lt;int&gt; 194, 191, 190, 197, 198, 200, 192, 187, 186, 192, 18…
## $ ArrDelay          &lt;int&gt; 12, 6, 9, 40, 35, 41, 38, 18, 19, 10, 29, 33, 35, 4,…
## $ DepDelay          &lt;int&gt; 6, -1, 1, 2, 14, 35, 4, 0, 6, 9, 6, 17, 38, 11, 3, -…
## $ Origin            &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IAH&quot;, &quot;IA…
## $ Dest              &lt;chr&gt; &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LAX&quot;, &quot;LA…
## $ Distance          &lt;int&gt; 1379, 1379, 1379, 1379, 1379, 1379, 1379, 1379, 1379…
## $ TaxiIn            &lt;int&gt; 10, 13, 15, 18, 12, 10, 14, 19, 12, 12, 20, 15, 12, …
## $ TaxiOut           &lt;int&gt; 15, 19, 19, 39, 27, 12, 44, 25, 31, 13, 39, 18, 15, …
## $ Cancelled         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ CancellationCode  &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, …
## $ Diverted          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="dplyr.html#cb510-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the first five rows of the `flight815` variable</span></span>
<span id="cb510-2"><a href="dplyr.html#cb510-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(flight815)</span>
<span id="cb510-3"><a href="dplyr.html#cb510-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb510-4"><a href="dplyr.html#cb510-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( <span class="st">&quot;------------------------&quot;</span>)</span>
<span id="cb510-5"><a href="dplyr.html#cb510-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb510-6"><a href="dplyr.html#cb510-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print the first five rows of the `grouped815` variable</span></span>
<span id="cb510-7"><a href="dplyr.html#cb510-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(grouped815)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 21
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     4         30         6    2116    2255 CO                  815
## 2  2011     4         29         5    2109    2252 CO                  815
## 3  2011     4         28         4    2111    2255 CO                  815
## 4  2011     4         27         3    2112    2326 CO                  815
## 5  2011     4         26         2    2124    2321 CO                  815
## 6  2011     4         25         1    2145    2327 CO                  815
## # … with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;,
## #   Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;,
## #   CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;
## [1] &quot;------------------------&quot;
## # A tibble: 6 × 21
## # Groups:   Month [1]
##    Year Month DayofMonth DayOfWeek DepTime ArrTime UniqueCarrier FlightNum
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;
## 1  2011     4         30         6    2116    2255 CO                  815
## 2  2011     4         29         5    2109    2252 CO                  815
## 3  2011     4         28         4    2111    2255 CO                  815
## 4  2011     4         27         3    2112    2326 CO                  815
## 5  2011     4         26         2    2124    2321 CO                  815
## 6  2011     4         25         1    2145    2327 CO                  815
## # … with 13 more variables: TailNum &lt;chr&gt;, ActualElapsedTime &lt;int&gt;,
## #   AirTime &lt;int&gt;, ArrDelay &lt;int&gt;, DepDelay &lt;int&gt;, Origin &lt;chr&gt;, Dest &lt;chr&gt;,
## #   Distance &lt;int&gt;, TaxiIn &lt;int&gt;, TaxiOut &lt;int&gt;, Cancelled &lt;int&gt;,
## #   CancellationCode &lt;chr&gt;, Diverted &lt;int&gt;</code></pre>
</div>
<hr />
<p>We see that by grouping we have not “lost” any information - the grouped data frame still looks identical to the original, “non-grouped” frame. In fact, the only indication that something is different is the new, inherited class and the <code>Groups: ..</code> line in the structure print. This means that grouping a frame is merely an indication that some further (most often aggregation) operations are not necessarily performed over the entire data frame, but over individual groups. Also, if we want, we can always easily “ungroup” the frame with the help of the <code>ungroup</code> function.</p>
<p>For aggregation, we use the <code>summarise</code> function that receives data (a grouped table) and then combinations of aggregation functions and columns over which they are executed, for example:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="dplyr.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(df, <span class="at">meanA =</span> <span class="fu">mean</span>(a), <span class="at">sdA =</span> <span class="fu">sd</span>(a))</span></code></pre></div>
<p>As a rule, for the aggregation function we can use any function that reduces a vector to a single value (eg <code>mean</code>,<code>max</code>, <code>sd</code> etc.). Also, <code>dplyr</code> offers some useful functions like:</p>
<ul>
<li><code>first</code>,<code>last</code>, <code>nth</code> - retreieves the first, last, or n-th element of the group</li>
<li><code>n</code>,<code>n_distinct</code> - counts the number of (distinct) values</li>
</ul>
<hr />
<p><strong>Exercise 11.8 - function <code>summarise</code> </strong></p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="dplyr.html#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the average flight arrival delay for the data frames `flight815` and` grouped815`</span></span>
<span id="cb513-2"><a href="dplyr.html#cb513-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `summarise` function</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="dplyr.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(flight815, <span class="at">meanDelay =</span> <span class="fu">mean</span>(ArrDelay))</span>
<span id="cb514-2"><a href="dplyr.html#cb514-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( <span class="st">&quot;------------------------&quot;</span>)</span>
<span id="cb514-3"><a href="dplyr.html#cb514-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(grouped815, <span class="at">meanDelay =</span> <span class="fu">mean</span>(ArrDelay))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   meanDelay
##       &lt;dbl&gt;
## 1      21.6
## [1] &quot;------------------------&quot;
## # A tibble: 6 × 2
##   Month meanDelay
##   &lt;int&gt;     &lt;dbl&gt;
## 1     4      21.1
## 2     5      20.9
## 3     6      28.0
## 4     8     -27.5
## 5     9      14  
## 6    10     -13</code></pre>
</div>
<p>Note that it is advisable to name the aggregated columns.</p>
<hr />
<p>In practice, we usually do not create separate “grouped” data frames but rather we carry out the entire process of selecting rows and columns, grouping, and performing aggregation in a single command. If we use the operator <code>%&gt;%</code>, then it a possible example might look like this:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="dplyr.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(df, a<span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(a, b) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">meanC =</span> <span class="fu">mean</span>(c)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(b))</span></code></pre></div>
<p>Finally, let us reiterate the readily apparent similarity of the above expression with <em>SQL</em> queries in relational databases, with the essential difference that we perform operations here procedurally, which greatly increases readability and allows us to easily store and check the intermediate result at any time.</p>
<p>Now let’s try to take advantage of all the current knowledge of the <code>dplyr</code> package and solve the following examples. All tasks are related to the entire <code>hflights</code> dataset.</p>
<hr />
<p><strong>Exercise 11.9 - advanced queries</strong></p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="dplyr.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print out how many flights were canceled because of</span></span>
<span id="cb517-2"><a href="dplyr.html#cb517-2" aria-hidden="true" tabindex="-1"></a><span class="co"># bad weather in each month</span></span>
<span id="cb517-3"><a href="dplyr.html#cb517-3" aria-hidden="true" tabindex="-1"></a><span class="co"># result table must have contain only columns called</span></span>
<span id="cb517-4"><a href="dplyr.html#cb517-4" aria-hidden="true" tabindex="-1"></a><span class="co"># `Month` and` BadWeatherCancellations`</span></span>
<span id="cb517-5"><a href="dplyr.html#cb517-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb517-6"><a href="dplyr.html#cb517-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the average time of arrival delay</span></span>
<span id="cb517-7"><a href="dplyr.html#cb517-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for departing flights to airports</span></span>
<span id="cb517-8"><a href="dplyr.html#cb517-8" aria-hidden="true" tabindex="-1"></a><span class="co"># LAX, JFK and LGA on different days of the week</span></span>
<span id="cb517-9"><a href="dplyr.html#cb517-9" aria-hidden="true" tabindex="-1"></a><span class="co"># name the new column &#39;MeanArrDelay&#39;</span></span>
<span id="cb517-10"><a href="dplyr.html#cb517-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ignore rows with NA values</span></span>
<span id="cb517-11"><a href="dplyr.html#cb517-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the result by descending average delay time</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="dplyr.html#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print out how many flights were canceled because of</span></span>
<span id="cb518-2"><a href="dplyr.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="co"># bad weather in each month</span></span>
<span id="cb518-3"><a href="dplyr.html#cb518-3" aria-hidden="true" tabindex="-1"></a><span class="co"># result table must have contain only columns called</span></span>
<span id="cb518-4"><a href="dplyr.html#cb518-4" aria-hidden="true" tabindex="-1"></a><span class="co"># `Month` and` BadWeatherCancellations`</span></span>
<span id="cb518-5"><a href="dplyr.html#cb518-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(hflights, CancellationCode <span class="sc">==</span> <span class="st">&#39;B&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb518-6"><a href="dplyr.html#cb518-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb518-7"><a href="dplyr.html#cb518-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">BadWeatherCancellations =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 12 × 2
##    Month BadWeatherCancellations
##    &lt;int&gt;                   &lt;int&gt;
##  1     1                     149
##  2     2                     929
##  3     3                      50
##  4     4                      40
##  5     5                     106
##  6     6                      49
##  7     7                      29
##  8     8                     108
##  9     9                      38
## 10    10                      46
## 11    11                      13
## 12    12                      95</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="dplyr.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print out the average time of arrival delay</span></span>
<span id="cb520-2"><a href="dplyr.html#cb520-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for departing flights to airports</span></span>
<span id="cb520-3"><a href="dplyr.html#cb520-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LAX, JFK and LGA on different days of the week</span></span>
<span id="cb520-4"><a href="dplyr.html#cb520-4" aria-hidden="true" tabindex="-1"></a><span class="co"># name the new column &#39;MeanArrDelay&#39;</span></span>
<span id="cb520-5"><a href="dplyr.html#cb520-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ignore rows with NA values</span></span>
<span id="cb520-6"><a href="dplyr.html#cb520-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the result by descending average delay time</span></span>
<span id="cb520-7"><a href="dplyr.html#cb520-7" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(hflights, Dest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;LAX&#39;</span>, <span class="st">&#39;JFK&#39;</span>, <span class="st">&#39;LGA&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(DayOfWeek, Dest) <span class="sc">%&gt;%</span></span>
<span id="cb520-8"><a href="dplyr.html#cb520-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">MeanArrDelay =</span> <span class="fu">round</span>(<span class="fu">mean</span>(ArrDelay,</span>
<span id="cb520-9"><a href="dplyr.html#cb520-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">na.rm =</span> T), <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb520-10"><a href="dplyr.html#cb520-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(MeanArrDelay))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;DayOfWeek&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 21 × 3
##    DayOfWeek Dest  MeanArrDelay
##        &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1         4 LGA          21.3 
##  2         4 JFK          17.2 
##  3         5 LGA          13.6 
##  4         1 LGA          13.5 
##  5         7 JFK          10.8 
##  6         1 LAX          10.7 
##  7         3 LGA          10.5 
##  8         4 LAX          10.3 
##  9         2 LGA           9.85
## 10         6 JFK           9.76
## # … with 11 more rows</code></pre>
</div>
<p><strong>Exercise 11.10 - advanced queries (2)</strong></p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="dplyr.html#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in the tasks that follow, imagine you wrote your own </span></span>
<span id="cb523-2"><a href="dplyr.html#cb523-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function that finds the most common category:</span></span>
<span id="cb523-3"><a href="dplyr.html#cb523-3" aria-hidden="true" tabindex="-1"></a>mostFreqValue <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">table</span>(x) <span class="sc">%&gt;%</span> <span class="fu">sort</span>(<span class="at">decreasing =</span> T) <span class="sc">%&gt;%</span> names<span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">[</span><span class="st">`</span>(<span class="dv">1</span>)</span>
<span id="cb523-4"><a href="dplyr.html#cb523-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-5"><a href="dplyr.html#cb523-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-6"><a href="dplyr.html#cb523-6" aria-hidden="true" tabindex="-1"></a><span class="co"># in the `hflights` table, divide the delay time</span></span>
<span id="cb523-7"><a href="dplyr.html#cb523-7" aria-hidden="true" tabindex="-1"></a><span class="co"># in 10 categories with the help of the `ntile` function</span></span>
<span id="cb523-8"><a href="dplyr.html#cb523-8" aria-hidden="true" tabindex="-1"></a><span class="co"># call the new column `ArrDelayCatId`</span></span>
<span id="cb523-9"><a href="dplyr.html#cb523-9" aria-hidden="true" tabindex="-1"></a><span class="co"># then print all the category ids,</span></span>
<span id="cb523-10"><a href="dplyr.html#cb523-10" aria-hidden="true" tabindex="-1"></a><span class="co"># total number of flights within a category,</span></span>
<span id="cb523-11"><a href="dplyr.html#cb523-11" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum and maximum time of arrival delay</span></span>
<span id="cb523-12"><a href="dplyr.html#cb523-12" aria-hidden="true" tabindex="-1"></a><span class="co"># and which airport most often</span></span>
<span id="cb523-13"><a href="dplyr.html#cb523-13" aria-hidden="true" tabindex="-1"></a><span class="co"># appears in this category</span></span>
<span id="cb523-14"><a href="dplyr.html#cb523-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-15"><a href="dplyr.html#cb523-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-16"><a href="dplyr.html#cb523-16" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat the previous example but instead of the function</span></span>
<span id="cb523-17"><a href="dplyr.html#cb523-17" aria-hidden="true" tabindex="-1"></a><span class="co"># `ntile` try the` cut` function</span></span></code></pre></div>
<p><strong>Exercise 11.11 - advanced queries (2)</strong></p>
<div class="fold s o">
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="dplyr.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in the `hflights` table, divide the delay time</span></span>
<span id="cb524-2"><a href="dplyr.html#cb524-2" aria-hidden="true" tabindex="-1"></a><span class="co"># in 10 categories with the help of the `ntile` function</span></span>
<span id="cb524-3"><a href="dplyr.html#cb524-3" aria-hidden="true" tabindex="-1"></a><span class="co"># call the new column `ArrDelayCatId`</span></span>
<span id="cb524-4"><a href="dplyr.html#cb524-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print an identifier for each category</span></span>
<span id="cb524-5"><a href="dplyr.html#cb524-5" aria-hidden="true" tabindex="-1"></a><span class="co"># categories, total number of flights within a category,</span></span>
<span id="cb524-6"><a href="dplyr.html#cb524-6" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum and maximum time of arrival delay</span></span>
<span id="cb524-7"><a href="dplyr.html#cb524-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and which airport is most often</span></span>
<span id="cb524-8"><a href="dplyr.html#cb524-8" aria-hidden="true" tabindex="-1"></a><span class="co"># appears in this category</span></span>
<span id="cb524-9"><a href="dplyr.html#cb524-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-10"><a href="dplyr.html#cb524-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(hflights, <span class="at">ArrDelayCatId =</span> <span class="fu">ntile</span>(ArrDelay, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb524-11"><a href="dplyr.html#cb524-11" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(ArrDelayCatId) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">totalFlights =</span> <span class="fu">n</span>(), <span class="at">minArrDelay =</span> <span class="fu">min</span>(ArrDelay), <span class="at">maxArrDelay =</span> <span class="fu">max</span>(ArrDelay), <span class="at">mostFreqDest =</span> <span class="fu">mostFreqValue</span>(Dest))</span></code></pre></div>
<pre><code>## # A tibble: 11 × 5
##    ArrDelayCatId totalFlights minArrDelay maxArrDelay mostFreqDest
##            &lt;int&gt;        &lt;int&gt;       &lt;int&gt;       &lt;int&gt; &lt;chr&gt;       
##  1             1        22388         -70         -14 ATL         
##  2             2        22388         -14          -9 ATL         
##  3             3        22388          -9          -6 DAL         
##  4             4        22388          -6          -3 DAL         
##  5             5        22387          -3           0 DAL         
##  6             6        22387           0           3 DAL         
##  7             7        22387           3           8 DAL         
##  8             8        22387           8          15 DAL         
##  9             9        22387          15          32 DAL         
## 10            10        22387          32         978 DAL         
## 11            NA         3622          NA          NA DAL</code></pre>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="dplyr.html#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat the previous example but instead of the function</span></span>
<span id="cb526-2"><a href="dplyr.html#cb526-2" aria-hidden="true" tabindex="-1"></a><span class="co"># `ntile` try the` cut` function</span></span>
<span id="cb526-3"><a href="dplyr.html#cb526-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-4"><a href="dplyr.html#cb526-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(hflights, <span class="at">ArrDelayCat =</span> <span class="fu">cut</span>(ArrDelay, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb526-5"><a href="dplyr.html#cb526-5" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(ArrDelayCat) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">totalFlights =</span> <span class="fu">n</span>(), <span class="at">minArrDelay =</span> <span class="fu">min</span>(ArrDelay), <span class="at">maxArrDelay =</span> <span class="fu">max</span>(ArrDelay), <span class="at">mostFreqDest =</span> <span class="fu">mostFreqValue</span>(Dest))</span></code></pre></div>
<pre><code>## # A tibble: 11 × 5
##    ArrDelayCat totalFlights minArrDelay maxArrDelay mostFreqDest
##    &lt;fct&gt;              &lt;int&gt;       &lt;int&gt;       &lt;int&gt; &lt;chr&gt;       
##  1 (-71,34.8]        203101         -70          34 DAL         
##  2 (34.8,140]         18551          35         139 DAL         
##  3 (140,244]           1849         140         244 ATL         
##  4 (244,349]            294         245         346 ATL         
##  5 (349,454]             48         350         450 ATL         
##  6 (454,559]             16         458         556 ATL         
##  7 (559,664]              4         579         663 DFW         
##  8 (664,768]              4         685         766 DFW         
##  9 (768,873]              4         775         861 DEN         
## 10 (873,979]              3         918         978 DFW         
## 11 &lt;NA&gt;                3622          NA          NA DAL</code></pre>
</div>
<hr />
</div>
<div id="merging-data-frames-with-join-functions" class="section level2 hasAnchor" number="11.8">
<h2><span class="header-section-number">11.8</span> Merging data frames with join functions<a href="dplyr.html#merging-data-frames-with-join-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Merging data frames is an operation known to all developers who have experience in working with relational databases and <em>SQL</em>. When stored in a relational database, tables are often decomposed into multiple tables by a process called “normalization”. The purpose of normalization is mainly to eliminate unnecessary redundancy - each table retains enough data to reconstruct the original data, i.e. sets of observations, which is done through the “join” operation.</p>
<p>Although there are different forms of joining tables, by far the most common is the so-called a “natural” join where we have unique identifiers in one table related to the data in the other table. For example - suppose we have a <code>student</code> and <code>city</code> tables, where a <code>student</code> table may have a column that stores the zip code of the user’s place of residence, while other location-related information is in the <code>city</code> table. Storing this information in the <code>students</code> table would be redundant, since the zip code as such uniquely identifies a city, and if we want to see the names of the cities when printing users, we perform a natural join of two tables by the zip code of the city. This zip code is the so-called “foreign key” in the <code>student</code> table and at the same time “primary key” in table <code>city</code>.</p>
<p>We will create two simple data frames to demonstrate this.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="dplyr.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initializing the `user` and` place` data frames</span></span>
<span id="cb528-2"><a href="dplyr.html#cb528-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-3"><a href="dplyr.html#cb528-3" aria-hidden="true" tabindex="-1"></a>student <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span> <span class="dv">3</span>), <span class="at">lastName =</span> <span class="fu">c</span>(<span class="st">&quot;Ivic&quot;</span>, <span class="st">&quot;Peric&quot;</span>, <span class="st">&quot;Anic&quot;</span>),</span>
<span id="cb528-4"><a href="dplyr.html#cb528-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">zipResidence =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">31000</span>, <span class="dv">10000</span>))</span>
<span id="cb528-5"><a href="dplyr.html#cb528-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-6"><a href="dplyr.html#cb528-6" aria-hidden="true" tabindex="-1"></a>city <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">zip =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">21000</span>, <span class="dv">31000</span>),</span>
<span id="cb528-7"><a href="dplyr.html#cb528-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nameCity =</span> <span class="fu">c</span>(<span class="st">&quot;Zagreb&quot;</span>, <span class="st">&quot;Split&quot;</span>, <span class="st">&quot;Osijek&quot;</span>))</span></code></pre></div>
<p>If we want to have a data frame with columns <em>(id, lastName, zipResidence, nameCity)</em>, then we need to naturally merge the two data frames. For this, the <code>dplyr</code> package offers the<code>inner_join</code> function. For example, if we want to join data frames <code>df1</code> and <code>df2</code>, then we can perform the natural join like this:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="dplyr.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;s1&quot;</span> <span class="ot">=</span> <span class="st">&quot;s2&quot;</span>))</span></code></pre></div>
<p>where the character strings <code>"s1"</code> and <code>"s2"</code> denote the column names of these “left” and “right” frames that we are joining (note only one equality sign! ). If the column we use has the same name in both tables, we can only specify the name of that column (or the character vector of multiple columns if we connect via a so-called “composite” foreign key), or omit this parameter completely (if the columns to which we perform merging are the only columns whose names match).</p>
<hr />
<p><strong>Exercise 11.12 - natural join</strong></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="dplyr.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the result of natural joining of data frames `student` and `city`</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="dplyr.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the result of natural joining of data frames `student` and `city`</span></span>
<span id="cb531-2"><a href="dplyr.html#cb531-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(student, city, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;zipResidence&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip&quot;</span>))</span></code></pre></div>
<pre><code>##   id lastName zipResidence nameCity
## 1  1     Ivic        10000   Zagreb
## 2  2    Peric        31000   Osijek
## 3  3     Anic        10000   Zagreb</code></pre>
</div>
<hr />
<p>Keep in mind that joining is a very “expensive” operation; if you join frames with a very large number of rows, the operation could take a very long time and take up a lot of memory. In the event that such “large” joins are often required, then it is strongly recommended to use the <code>data.table</code> package, which implements algorithms with significantly better performance in join operations (using indexing), or - if we work with relational database as a data source - perform the joins on the database side and then pull the result in <em>R</em>. In the next section, we will show how this can potentially be done without having to explicitly write separate <em>SQL</em> commands.</p>
<p>If we look at the result of the example above, we can see that we “lost” one row from the <code>city</code> table. Specifically, line <em>(21000, ‘Split’)</em> had no corresponding student and “disappeared” from the result. This is a completely expected result of a natural join, but there are times when we want to keep all the rows from one of the tables we merge. In this case, we have the option of using the so-called “outer natural join” which works identically to the “inner” natural join that we have already seen, but retains all rows from one or both of the tables so that the rows that fail to join remain in the result but with <code>NA</code> values on the opposite side. We distinguish between “left”, “right”, and “full” outer join, depending on whether we want to keep all rows from the left, right or both tables. The <code>dplyr</code> package offers functions that perform all these types of joins, they have a signature identical to the function seen above and are called<code>left_join</code>, <code>right_join</code> and<code>full_join</code>.</p>
<hr />
<p><strong>Exercise 11.13 - outer join</strong></p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="dplyr.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the result of natural joining of data frames `student` and `city`</span></span>
<span id="cb533-2"><a href="dplyr.html#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="co"># which retains all rows from the `city` table</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="dplyr.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the result of natural joining of data frames `student` and `city`</span></span>
<span id="cb534-2"><a href="dplyr.html#cb534-2" aria-hidden="true" tabindex="-1"></a><span class="co"># which retains all rows from the `city` table</span></span>
<span id="cb534-3"><a href="dplyr.html#cb534-3" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(student, city, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;zipResidence&quot;</span> <span class="ot">=</span> <span class="st">&quot;zip&quot;</span>))</span></code></pre></div>
<pre><code>##   id lastName zipResidence nameCity
## 1  1     Ivic        10000   Zagreb
## 2  2    Peric        31000   Osijek
## 3  3     Anic        10000   Zagreb
## 4 NA     &lt;NA&gt;        21000    Split</code></pre>
</div>
<hr />
</div>
<div id="integrating-dplyr-with-relational-databases" class="section level2 hasAnchor" number="11.9">
<h2><span class="header-section-number">11.9</span> Integrating <code>dplyr</code> with relational databases<a href="dplyr.html#integrating-dplyr-with-relational-databases" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Relational databases are a common source of data for the analysis done in <em>R</em>. One of the standard procedures for preparing data for the analytical process is the exporting from the database to a <em>CSV</em> file, which is then loaded into <em>R</em>. Often, before creating a <em>CSV</em> file, the data from the database must first be adequately collected and prepared, which means that the overall data preparation process requires initial work done in the <em>SQL</em> language directly on the database. This is especially important if we are working with larger datasets that would unnecessarily burden the machine that runs <em>R</em>, and which could be processed much more efficiently in the database itself.</p>
<p>The above does not necessarily mean that we need a separate tool to run <em>SQL</em> queries for collecting data from the database. <em>R</em> contains a number of packages for directly communicating with more popular databases, such as <em>MySQL</em> or <em>PostgreSQL</em>. With these packages, we can connect to the base and execute <em>SQL</em> queries directly within the <em>R</em> script, all with the help of R commands, with the result being a data frame ready for further analysis in <em>R</em>. For example, communicating with the <em>MySQL</em> database from R might look like this:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="dplyr.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;RMySQL&quot;</span>)</span>
<span id="cb536-2"><a href="dplyr.html#cb536-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-3"><a href="dplyr.html#cb536-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RMySQL)</span>
<span id="cb536-4"><a href="dplyr.html#cb536-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-5"><a href="dplyr.html#cb536-5" aria-hidden="true" tabindex="-1"></a><span class="co"># enter real parameters in a realistic scenario!</span></span>
<span id="cb536-6"><a href="dplyr.html#cb536-6" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">MySQL</span>(), <span class="at">user =</span> <span class="st">&#39;user&#39;</span>, <span class="at">password =</span> <span class="st">&#39;password&#39;</span>, <span class="at">dbname =</span> <span class="st">&#39;database_name&#39;</span>, <span class="at">host =</span> <span class="st">&#39;host&#39;</span>)</span>
<span id="cb536-7"><a href="dplyr.html#cb536-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-8"><a href="dplyr.html#cb536-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">&quot;SELECT * FROM MY_TABLE&quot;</span>)</span></code></pre></div>
<p>We see that we first need to load the package with support for connecting to the selected database, then establish a connection with that database (parameters are usually provided to us by the database administrator), followed by providing <em>SQL</em> queries wrapped in appropriate function calls. Although this approach is not complicated and is relatively common, it unmistakably requires mixing <em>R</em> and <em>SQL</em> and programming code.</p>
<p>The <code>dplyr</code> package can offer assistance here by relieving the developer of the need to write <em>SQL</em> queries inside the <em>R</em> script. Specifically, <code>dplyr</code> contains integrated support for the automatic conversion of expressions that use <code>dplyr</code> functions directly into an <em>SQL</em> query, which is transparent to the user. In other words, to some extent, we can work on a relational database in the same way as if it we are working on an <em>R</em> data frame. We should be careful here because not all <code>dplyr</code> functionality is translatable into <em>SQL</em>, but most standard preparatory operations such as joining and filtering can be done directly in the database, all the while using just <em>R</em> programming code.</p>
<p>In order to put this into practice, we need a working relational database. As it is somewhat impractical to install or prepare an existing relational database just for the needs of a quick example, we can use an efficient alternative offered by the <code>RSQLite</code> package. It allows us to create an <em>SQLite</em> database, a simple relational database that does not require any special installation, does not use a server and holds all its data in one file.</p>
<p>In the next program section, we load the <em>RSQLite</em> package, create a new database by creating a new file and saving the <code>mtcars</code> dataframe into a relational table called <code>CARS</code>.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="dplyr.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># installing and loading the `RSQLite` library - perform if necessary</span></span>
<span id="cb537-2"><a href="dplyr.html#cb537-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages ( &quot;RSQLite&quot;)</span></span>
<span id="cb537-3"><a href="dplyr.html#cb537-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(RSQLite)</span></span>
<span id="cb537-4"><a href="dplyr.html#cb537-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-5"><a href="dplyr.html#cb537-5" aria-hidden="true" tabindex="-1"></a><span class="co"># opening connection with the &quot;SQLite&quot; database</span></span>
<span id="cb537-6"><a href="dplyr.html#cb537-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (we&#39;re actually creating a file called simply &#39;mybase&#39;)</span></span>
<span id="cb537-7"><a href="dplyr.html#cb537-7" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="at">drv =</span> <span class="fu">SQLite</span>(), <span class="at">dbname =</span> <span class="st">&quot;mybase&quot;</span>)</span>
<span id="cb537-8"><a href="dplyr.html#cb537-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-9"><a href="dplyr.html#cb537-9" aria-hidden="true" tabindex="-1"></a><span class="co"># creating the `CARS` relational table</span></span>
<span id="cb537-10"><a href="dplyr.html#cb537-10" aria-hidden="true" tabindex="-1"></a><span class="co"># by using R&#39;s `mtcars` sample dataset</span></span>
<span id="cb537-11"><a href="dplyr.html#cb537-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(conn, <span class="st">&quot;CARS&quot;</span>, mtcars, <span class="at">overwrite =</span> T)</span>
<span id="cb537-12"><a href="dplyr.html#cb537-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb537-13"><a href="dplyr.html#cb537-13" aria-hidden="true" tabindex="-1"></a><span class="co"># checking the list of all existing tables</span></span>
<span id="cb537-14"><a href="dplyr.html#cb537-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(conn)</span></code></pre></div>
<pre><code>## [1] &quot;CARS&quot;</code></pre>
<p>The usual way to collect data from a database is to embed <em>SQL</em> queries directly into the <em>R</em> program code and store the results in a variable.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="dplyr.html#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get information on the maximum speed and weight of all 6-cylinder cars</span></span>
<span id="cb539-2"><a href="dplyr.html#cb539-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(conn, <span class="st">&quot;SELECT mpg, wt FROM CARS WHERE cyl = 6&quot;</span>)</span></code></pre></div>
<pre><code>##    mpg    wt
## 1 21.0 2.620
## 2 21.0 2.875
## 3 21.4 3.215
## 4 18.1 3.460
## 5 19.2 3.440
## 6 17.8 3.440
## 7 19.7 2.770</code></pre>
<p>If we know SQL well, then this method of data collection probably does not seem overly complex and in fact, many developers and analysts are happy to combine <em>SQL</em> and <em>R</em>, optimizing the process of data collection and preparation. However, if we are not too knowledgable in <em>SQL</em> (or simply want a “cleaner” code), we can use the tools provided by the <code>dplyr</code> package.</p>
<p>In the following example, we will repeat the process of connecting to the database, but we will execute everything with <code>dplyr</code> functions.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="dplyr.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="co"># connecting to an existing SQLite database!</span></span>
<span id="cb541-2"><a href="dplyr.html#cb541-2" aria-hidden="true" tabindex="-1"></a>conn2 <span class="ot">&lt;-</span> <span class="fu">src_sqlite</span>(<span class="st">&quot;mybase&quot;</span>, <span class="at">create =</span> <span class="cn">FALSE</span>)</span>
<span id="cb541-3"><a href="dplyr.html#cb541-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb541-4"><a href="dplyr.html#cb541-4" aria-hidden="true" tabindex="-1"></a><span class="co"># checking the list of the existing tables</span></span>
<span id="cb541-5"><a href="dplyr.html#cb541-5" aria-hidden="true" tabindex="-1"></a><span class="fu">src_tbls</span>(conn2)</span>
<span id="cb541-6"><a href="dplyr.html#cb541-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb541-7"><a href="dplyr.html#cb541-7" aria-hidden="true" tabindex="-1"></a><span class="co"># getting a reference to the existing table</span></span>
<span id="cb541-8"><a href="dplyr.html#cb541-8" aria-hidden="true" tabindex="-1"></a><span class="co"># no data gets loaded yet!</span></span>
<span id="cb541-9"><a href="dplyr.html#cb541-9" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">tbl</span>(conn2, <span class="st">&quot;CARS&quot;</span>)</span>
<span id="cb541-10"><a href="dplyr.html#cb541-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb541-11"><a href="dplyr.html#cb541-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get information on the maximum speed and weight of all 6-cylinder cars</span></span>
<span id="cb541-12"><a href="dplyr.html#cb541-12" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cyl <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(mpg, wt) <span class="sc">%&gt;%</span> collect</span></code></pre></div>
<pre><code>## Warning: `src_sqlite()` was deprecated in dplyr 1.0.0.
## ℹ Please use `tbl()` directly with a database connection</code></pre>
<pre><code>## [1] &quot;CARS&quot;
## # A tibble: 7 × 2
##     mpg    wt
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  21    2.62
## 2  21    2.88
## 3  21.4  3.22
## 4  18.1  3.46
## 5  19.2  3.44
## 6  17.8  3.44
## 7  19.7  2.77</code></pre>
<p>One thing to note is that <code>dplyr</code> will not perform anything until we explicitly request the collection of the information, and even then it will retrieve it “in portions” to save memory. This is why we explicitly used the <code>collect</code> function in the example above, essentially forcing <em>R</em> to put the entire result into a data frame (our in our case, simply printting it on the screen). In this way, the <em>R</em> programmer can significantly relieve his <em>R</em> environment by shifting the responsibility of “heavy” operations to the database, while keeping a consistent syntax regardless of whether the operations are done on the database or in memory as <em>R</em> objects.</p>
<hr />
</div>
<div id="homework-exercises-9" class="section level2 unnumbered hasAnchor">
<h2>Homework exercises<a href="dplyr.html#homework-exercises-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>IThe following exercises use the <em>mammals sleep</em> dataset available in the visualization package <code>ggplot2</code>. Load the <code>ggplot2</code> package and then put the <code>msleep</code> data frame in the global environment using the <code>data</code> function.</p>
<p>Before solving the exercises be sure to explore the dataset and learn its features. Then do the following</p>
<ol style="list-style-type: decimal">
<li><p>For 10 herbivores who sleep the longest, print their name, how many hours per day they sleep and their average body weight in kg. Sort the entries by sleep length in a descending order.</p></li>
<li><p>Print the average, longest and shortest sleep time of the animals depending on their type of diet.</p></li>
<li><p>Categorize the total sleeping time in 5 bins of equal length. For each category, print the total number of animals belonging to the category, and then the total number of class members who are not herbivores. Results should be sorted by sleep length in a descending order. Columns should have meaningful names and the final table should not contain NA values.</p></li>
<li><p>The following data frame contains the status codes for animal conservation status and their descriptions:</p></li>
</ol>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="dplyr.html#cb544-1" aria-hidden="true" tabindex="-1"></a>conservationStatus <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( </span>
<span id="cb544-2"><a href="dplyr.html#cb544-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">code =</span> <span class="fu">c</span>(<span class="st">&quot;ex&quot;</span>, <span class="st">&quot;ew&quot;</span>, <span class="st">&quot;cr&quot;</span>, <span class="st">&quot;en&quot;</span>, <span class="st">&quot;vu&quot;</span>, <span class="st">&quot;nt&quot;</span>, <span class="st">&quot;cd&quot;</span>, <span class="st">&quot;lc&quot;</span>),</span>
<span id="cb544-3"><a href="dplyr.html#cb544-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(<span class="st">&quot;extinct&quot;</span>, <span class="st">&quot;extinct in the wild&quot;</span>, </span>
<span id="cb544-4"><a href="dplyr.html#cb544-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;critically endangered&quot;</span>, <span class="st">&quot;endangered&quot;</span>,</span>
<span id="cb544-5"><a href="dplyr.html#cb544-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;vulnerable&quot;</span>, <span class="st">&quot;near threatened&quot;</span>, </span>
<span id="cb544-6"><a href="dplyr.html#cb544-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;conservation dependent&quot;</span>, <span class="st">&quot;least concern&quot;</span>))</span></code></pre></div>
<p>Add a <code>conservationDesc</code> column to ¸the <code>msleep</code> dataframe which will contain the correspoding conservation status descriptions. Be sure not to lose any rows from the <code>msleep</code> data frame.</p>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dates.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"edit": null,
"download": null,
"search": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
