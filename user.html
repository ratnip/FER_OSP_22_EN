<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 User Defined Functions | Let’s program in R</title>
  <meta name="description" content="R Coursebook" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="7 User Defined Functions | Let’s program in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="R Coursebook" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 User Defined Functions | Let’s program in R" />
  
  <meta name="twitter:description" content="R Coursebook" />
  

<meta name="author" content="Damir Pintar" />


<meta name="date" content="2022-12-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="packages.html"/>
<link rel="next" href="objects.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>

<style type="text/css">
.showopt {
  background-color: #004c93;
  color: #FFFFFF; 
  width: 140px;
  height: 4	0px;
  text-align: center;
  vertical-align: middle !important;
  float: right;
  font-family: sans-serif;
  font-size:10 pt;
  border-radius: 8px;
}

.showopt:hover {
    background-color: #dfe4f2;
    color: #004c93;
}

pre.plot {
  background-color: white !important;
}
</style>

<script>
 $(document).ready(function() {

  $chunks = $('.fold');

  $chunks.each(function () {

    // add button to source code chunks
    if ( $(this).hasClass('s') ) {
      $('pre.r', this).prepend("<div class=\"showopt\">Show solution</div><br style=\"line-height:22px;\"/>");
      $('pre.r', this).children('code').attr('class', 'folded');
    }

    // add button to output chunks
    if ( $(this).hasClass('o') ) {
      $('pre:not(.r)', this).has('code').prepend("<div class=\"showopt\">Show results</div><br style=\"line-height:22px;\"/>");
      $('pre:not(.r)', this).children('code:not(r)').addClass('folded');

      // add button to plots
      $(this).find('img').wrap('<pre class=\"plot\"></pre>');
      $('pre.plot', this).prepend("<div class=\"showopt\">Show figure</div><br style=\"line-height:22px;\"/>");
      $('pre.plot', this).children('img').addClass('folded');

    }
  });

  // hide all chunks when document is loaded
  $('.folded').css('display', 'none')

  // function to toggle the visibility
  $('.showopt').click(function() {
    var label = $(this).html();
    if (label.indexOf("Show") >= 0) {
      $(this).html(label.replace("Show", "Hide"));
    } else {
      $(this).html(label.replace("Hide", "Show"));
    }
    $(this).siblings('code, img').slideToggle('fast', 'swing');
  });
});
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>(“Statistical Programming Fundamentals” course book)</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#foreword"><i class="fa fa-check"></i>Foreword</a></li>
</ul></li>
<li class="part"><span><b>I Basic elements of R</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#general-facts-about-r"><i class="fa fa-check"></i><b>1.1.1</b> General facts about R</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#r-alternatives"><i class="fa fa-check"></i><b>1.1.2</b> R alternatives</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#installing-software-support"><i class="fa fa-check"></i><b>1.2</b> Installing Software Support</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#overview-of-the-development-interface-rstudio"><i class="fa fa-check"></i><b>1.3</b> Overview of the development interface <em>RStudio</em></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#interactive-console"><i class="fa fa-check"></i><b>1.3.1</b> Interactive console</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#writing-r-scripts"><i class="fa fa-check"></i><b>1.3.2</b> Writing R scripts</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#r-markdown"><i class="fa fa-check"></i><b>1.3.3</b> <em>R Markdown</em></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#how-to-use-this-coursebook"><i class="fa fa-check"></i><b>1.4</b> How to use this coursebook?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tipovi.html"><a href="tipovi.html"><i class="fa fa-check"></i><b>2</b> Basic data types and operators</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tipovi.html"><a href="tipovi.html#basic-data-types"><i class="fa fa-check"></i><b>2.1</b> Basic data types</a></li>
<li class="chapter" data-level="2.2" data-path="tipovi.html"><a href="tipovi.html#operators"><i class="fa fa-check"></i><b>2.2</b> Operators</a></li>
<li class="chapter" data-level="2.3" data-path="tipovi.html"><a href="tipovi.html#missing-unknown-and-non-existent-values"><i class="fa fa-check"></i><b>2.3</b> Missing, unknown, and non-existent values</a></li>
<li class="chapter" data-level="" data-path="tipovi.html"><a href="tipovi.html#homework-exercises"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vektori.html"><a href="vektori.html"><i class="fa fa-check"></i><b>3</b> Vectors, matrices and lists</a>
<ul>
<li class="chapter" data-level="3.1" data-path="vektori.html"><a href="vektori.html#vector"><i class="fa fa-check"></i><b>3.1</b> Vector</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="vektori.html"><a href="vektori.html#creating-a-vector"><i class="fa fa-check"></i><b>3.1.1</b> Creating a vector</a></li>
<li class="chapter" data-level="3.1.2" data-path="vektori.html"><a href="vektori.html#vector-concatenation"><i class="fa fa-check"></i><b>3.1.2</b> Vector concatenation</a></li>
<li class="chapter" data-level="3.1.3" data-path="vektori.html"><a href="vektori.html#operator"><i class="fa fa-check"></i><b>3.1.3</b> Operator <code>[</code></a></li>
<li class="chapter" data-level="3.1.4" data-path="vektori.html"><a href="vektori.html#principles-of-vectorization-and-recycling"><i class="fa fa-check"></i><b>3.1.4</b> Principles of vectorization and recycling</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vektori.html"><a href="vektori.html#index-vectors"><i class="fa fa-check"></i><b>3.2</b> Index vectors</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="vektori.html"><a href="vektori.html#positional-indexing"><i class="fa fa-check"></i><b>3.2.1</b> Positional Indexing</a></li>
<li class="chapter" data-level="3.2.2" data-path="vektori.html"><a href="vektori.html#conditional-indexing"><i class="fa fa-check"></i><b>3.2.2</b> Conditional indexing</a></li>
<li class="chapter" data-level="3.2.3" data-path="vektori.html"><a href="vektori.html#label-based-indexing"><i class="fa fa-check"></i><b>3.2.3</b> Label-based indexing</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vektori.html"><a href="vektori.html#matrices-and-arrays"><i class="fa fa-check"></i><b>3.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.4" data-path="vektori.html"><a href="vektori.html#matrix-slicing"><i class="fa fa-check"></i><b>3.4</b> Matrix slicing</a></li>
<li class="chapter" data-level="3.5" data-path="vektori.html"><a href="vektori.html#example-3.2---matrix-slicing"><i class="fa fa-check"></i><b>3.5</b> Example 3.2 - matrix slicing</a></li>
<li class="chapter" data-level="3.6" data-path="vektori.html"><a href="vektori.html#lists"><i class="fa fa-check"></i><b>3.6</b> Lists</a></li>
<li class="chapter" data-level="" data-path="vektori.html"><a href="vektori.html#homework-exercises-1"><i class="fa fa-check"></i>Homework exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="okviri.html"><a href="okviri.html"><i class="fa fa-check"></i><b>4</b> Data frames and factors</a>
<ul>
<li class="chapter" data-level="4.1" data-path="okviri.html"><a href="okviri.html#data-frames"><i class="fa fa-check"></i><b>4.1</b> Data frames</a></li>
<li class="chapter" data-level="4.2" data-path="okviri.html"><a href="okviri.html#selecting-rows-and-columns"><i class="fa fa-check"></i><b>4.2</b> Selecting rows and columns</a>
<ul>
<li class="chapter" data-level="10.1.2" data-path="dates.html"><a href="dates.html"><i class="fa fa-check"></i><b>10.1.2</b> The<code>POSIXct</code> and<code>POSIXlt</code> classes</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="dates.html"><a href="dates.html#the-lubridate-package"><i class="fa fa-check"></i><b>10.2</b> The <code>lubridate</code> package</a></li>
<li class="chapter" data-level="10.3" data-path="dates.html"><a href="dates.html#working-with-character-strings"><i class="fa fa-check"></i><b>10.3</b> Working with character strings</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="dates.html"><a href="dates.html#text-analysis-and-regular-expressions"><i class="fa fa-check"></i><b>10.3.1</b> Text analysis and regular expressions</a></li>
<li class="chapter" data-level="10.3.2" data-path="dates.html"><a href="dates.html#the-stringr-package"><i class="fa fa-check"></i><b>10.3.2</b> The <code>stringr</code> package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dates.html"><a href="dates.html#exercise-tasks-1"><i class="fa fa-check"></i>Exercise Tasks</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Let’s program in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="user" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> User Defined Functions<a href="user.html#user" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<hr />
<div id="user-defined-functions" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> User defined functions<a href="user.html#user-defined-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Although R is an object-oriented programming language, it leans heavily towards the realm of functional programming. This functional paradigm is not new (it dates back to the 1950s), but has recently gained considerable popularity as a kind of complement to the object-oriented programming, which might be said was the dominant programming paradigm in the last few decades.</p>
<p>In order not to delve too deep into the subject of functional programming and its relationship to object-oriented principles, we will list only a few indicative features and guidelines related to these two leading paradigms.</p>
<p><strong>Object-oriented programming</strong> in principle, sees the program as a system of <strong>nouns</strong> where the components are realized in the form of objects that encapsulate the attributes of the mentioned noun and the methods that perform certain tasks related to the given noun. Also, object-oriented systems focus on the <strong>controlled change of the components’ state</strong>, commonly as a result of the exchange of messages between them.</p>
<p><strong>Functional programming </strong> sees the program as a system of <strong>verbs</strong> where the functions, i.e. the tasks we want to execute, have priority over the components over which these tasks are executed. Functional programming models the information system through <strong>components that generally do not change their own state</strong>, so that the result of the program is strictly dependent on the inputs, which facilitates testing and maintenance.</p>
<p>In short, the distinction between object-oriented programming and function programming can be oversimplified as follows: <em>“For object-oriented programming, we create data that contains functions, and in functional programming we create functions that contain data”</em>.</p>
<p>We do not have to be too bothered with the features of functional programming to learn R, nor should it be necessary to adopt a completely new programming paradigm. But for successful mastering of R, adapting some of the functional programming concepts can prove to be extremely useful since it will allow us to write cleaner and more efficient code that will be in accordance with the way in which R is designed as a language.</p>
<p>In R, the following is true: <em>functions are “first-order” objects</em>, we can <em>reference them with a variable</em> of the selected environment, <em>send them to functions</em> as arguments, <em>receive as return values</em> function and <em>store them in data structures</em>, such as a list. The function in R is simply an “executable” object. A large number of functions - especially those that replace the program loop construct - work on the principle of functional languages where we perform the work in a manner that declaratively specifies which function we want to apply on which data structure, and let the programming language itself perform low-level tasks such as iteration by structure and preparation of the result. Examples of this will be learned soon, but now let’s first learn how to create our own functions in R.</p>
<hr />
<div id="defining-a-new-function" class="section level3 hasAnchor" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Defining a new function<a href="user.html#defining-a-new-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a general case, the definition of a new function looks like this:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="user.html#cb230-1" aria-hidden="true" tabindex="-1"></a>function_name <span class="ot">&lt;-</span> <span class="cf">function</span>(input arguments) {</span>
<span id="cb230-2"><a href="user.html#cb230-2" aria-hidden="true" tabindex="-1"></a>    function_body</span>
<span id="cb230-3"><a href="user.html#cb230-3" aria-hidden="true" tabindex="-1"></a>    return_statement</span>
<span id="cb230-4"><a href="user.html#cb230-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can notice that the function definition leverages the operator <code>&lt;-</code>. This is not a coincidence - the definition of a function is merely creating a “callable” variable in a certain environment - the name of that variable is the name of the function we are creating.</p>
<p>In R we do not define the types of input and output arguments. Input arguments have a name and an optional default value. The functions formally return one single value, which is not necessarily restrictive as it sounds - returning multiple variables simply means we wrap them first in the form of a vector or a list. The <code>return</code> keyword (whose syntax is like a function, i.e. <code>return(x)</code>) can be used to explicitly state what is being returned, but is actually optional - the function automatically returns the result of the last expression in the function, so we can simply put the name of the returning variable as the last line in the function, or even just leave the expression which calculates it, even though that can slightly compromise the readability.</p>
<p>For example, we can write a simple function that doubles the input parameter like this:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="user.html#cb231-1" aria-hidden="true" tabindex="-1"></a>doubleUp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb231-2"><a href="user.html#cb231-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb231-3"><a href="user.html#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb231-4"><a href="user.html#cb231-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>or, shorter:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="user.html#cb232-1" aria-hidden="true" tabindex="-1"></a>doubleUp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb232-2"><a href="user.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb232-3"><a href="user.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb232-4"><a href="user.html#cb232-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>or even like this:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="user.html#cb233-1" aria-hidden="true" tabindex="-1"></a>doubleUp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb233-2"><a href="user.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb233-3"><a href="user.html#cb233-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s try to create another simple function. For starters, let’s make our own implementation of the <code>abs</code> function, called <code>myAbs</code>.</p>
<p><strong>Exercise 7.1 - first user defined function</strong></p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="user.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function called `myAbs` which</span></span>
<span id="cb234-2"><a href="user.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="co"># will mimic R&#39;s `abs` function (but will not call it directly)</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="user.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function called `myAbs` which</span></span>
<span id="cb235-2"><a href="user.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="co"># will mimic R&#39;s `abs` function (but will not call it directly)</span></span>
<span id="cb235-3"><a href="user.html#cb235-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-4"><a href="user.html#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="co"># BAD SOLUTION!</span></span>
<span id="cb235-5"><a href="user.html#cb235-5" aria-hidden="true" tabindex="-1"></a>myAbs <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb235-6"><a href="user.html#cb235-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&lt;</span> <span class="dv">0</span>) <span class="sc">-</span>x <span class="cf">else</span> x</span>
<span id="cb235-7"><a href="user.html#cb235-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb235-8"><a href="user.html#cb235-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-9"><a href="user.html#cb235-9" aria-hidden="true" tabindex="-1"></a><span class="co"># try myAbs(c(1, -1)). Why doesn&#39;t this work correctly?</span></span></code></pre></div>
</div>
<div class="fold s o">
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="user.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a function called `myAbs` which</span></span>
<span id="cb236-2"><a href="user.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="co"># will mimic R&#39;s `abs` function (but will not call it directly)</span></span>
<span id="cb236-3"><a href="user.html#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-4"><a href="user.html#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="co"># GOOD SOLUTION</span></span>
<span id="cb236-5"><a href="user.html#cb236-5" aria-hidden="true" tabindex="-1"></a>myAbs <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb236-6"><a href="user.html#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="sc">-</span>x, x)</span>
<span id="cb236-7"><a href="user.html#cb236-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>We usually want to write functions which follow R’s philosophy of “everything is a vector”, so they should work properly on vectors, not just scalar, if it makes sense concerning the planned functionality.</p>
<p>Finally, if we want to increase the robustness of the function in such a way that we reject the execution of the logic within a function if certain conditions are not satisfied, we can use the <code>stopifnot</code> function. This function calculates the default logical expression and terminates the function if the specified condition <em>is not true</em>.</p>
<hr />
<p><strong>Exercise 7.2 - using <code>stopifnot</code> inside a function definition</strong></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="user.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the function `parallelMax` which requires two numeric vectors as input</span></span>
<span id="cb237-2"><a href="user.html#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and returns a vector of the same size containing the larger </span></span>
<span id="cb237-3"><a href="user.html#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between two corresponding elements of the original vectors</span></span>
<span id="cb237-4"><a href="user.html#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="co"># if one or both vectors aren&#39;t numeric or aren&#39;t the same size</span></span>
<span id="cb237-5"><a href="user.html#cb237-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the function must throw an error</span></span>
<span id="cb237-6"><a href="user.html#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="co"># do not use loops!</span></span>
<span id="cb237-7"><a href="user.html#cb237-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-8"><a href="user.html#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="co"># execute this new function over the following vector pairs</span></span>
<span id="cb237-9"><a href="user.html#cb237-9" aria-hidden="true" tabindex="-1"></a><span class="co"># c(T, F, T) i c(1, 2, 3)</span></span>
<span id="cb237-10"><a href="user.html#cb237-10" aria-hidden="true" tabindex="-1"></a><span class="co"># c(1, 2, 3, 4) i c(5, 6, 7)</span></span>
<span id="cb237-11"><a href="user.html#cb237-11" aria-hidden="true" tabindex="-1"></a><span class="co"># c(1, 2, 3) i c(0, 4, 2)</span></span>
<span id="cb237-12"><a href="user.html#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="user.html#cb237-13" aria-hidden="true" tabindex="-1"></a><span class="co"># (second part of the exercise should be tested inside the console!)</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="user.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write the function `parallelMax` which requires two numeric vectors as input</span></span>
<span id="cb238-2"><a href="user.html#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and returns a vector of the same size containing the larger </span></span>
<span id="cb238-3"><a href="user.html#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between two corresponding elements of the original vectors</span></span>
<span id="cb238-4"><a href="user.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co"># if one or both vectors aren&#39;t numeric or aren&#39;t the same size</span></span>
<span id="cb238-5"><a href="user.html#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the function must throw an error</span></span>
<span id="cb238-6"><a href="user.html#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="co"># do not use loops!</span></span>
<span id="cb238-7"><a href="user.html#cb238-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-8"><a href="user.html#cb238-8" aria-hidden="true" tabindex="-1"></a>parallelMax <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb238-9"><a href="user.html#cb238-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(a) <span class="sc">&amp;&amp;</span> <span class="fu">is.numeric</span>(b) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(a) <span class="sc">==</span> <span class="fu">length</span>(b));</span>
<span id="cb238-10"><a href="user.html#cb238-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(a <span class="sc">&gt;</span> b, a, b)</span>
<span id="cb238-11"><a href="user.html#cb238-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<hr />
<p>When calling a function, we can optionally specify the parameter names, and R will even allow the mixing of named and unnamed parameters (although this is not something we should often use in practice). When R connects the sent values with formal parameters, the named parameters will have priority and will be resolved first, after which the unnamed parameters will be resolved in te order they were provided.</p>
<p>We can see this in the next exercise, in which we will use the opportunity to showcase a very useful function - <code>paste</code>. This function concatenates character strings with the addition of a space separator (there is an alternative function <code>paste0</code> for joining without spaces).</p>
<hr />
<p><strong>Exercise 7.3 - function parameters</strong></p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="user.html#cb239-1" aria-hidden="true" tabindex="-1"></a>printABC <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, c) {</span>
<span id="cb239-2"><a href="user.html#cb239-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;A:&quot;</span>, a, <span class="st">&quot;B:&quot;</span>, b, <span class="st">&quot;C:&quot;</span>, c))   </span>
<span id="cb239-3"><a href="user.html#cb239-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb239-4"><a href="user.html#cb239-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-5"><a href="user.html#cb239-5" aria-hidden="true" tabindex="-1"></a><span class="co"># think before executing - what will be printed with the following command? </span></span>
<span id="cb239-6"><a href="user.html#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="co">#printABC(1, a = 2, 3)</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="user.html#cb240-1" aria-hidden="true" tabindex="-1"></a>printABC <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, c) {</span>
<span id="cb240-2"><a href="user.html#cb240-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;A:&quot;</span>, a, <span class="st">&quot;B:&quot;</span>, b, <span class="st">&quot;C:&quot;</span>, c))   </span>
<span id="cb240-3"><a href="user.html#cb240-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb240-4"><a href="user.html#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="user.html#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="co"># think before executing - what will be printed with the following command? </span></span>
<span id="cb240-6"><a href="user.html#cb240-6" aria-hidden="true" tabindex="-1"></a><span class="fu">printABC</span>(<span class="dv">1</span>, <span class="at">a =</span> <span class="dv">2</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;A: 2 B: 1 C: 3&quot;</code></pre>
</div>
<hr />
<p>In practice, we should stick to conventions which dictate first using unnamed parameters in the order they appear in the function definition, and then named. It is customary to set only those named parameters whose default value does not suit us, whereas strict ordering does not matter (although using the order provided in the function definition will increase the legibility of our code).</p>
<p>If we want to write a function that receives an arbitrary number of arguments, we can use the element <code>...</code>, i.e. the ellipsis. An example of this feature is the built-in <code>paste</code> function which can receive an arbitrary number of character strings. If we use the ellipsis in our functions, we should place them at the end of the list of input arguments, and within the function itself we simply convert it into a list, and then access its parameters in the way that suits us.</p>
<hr />
<p><strong>Exercise 7.4 - function with an arbitrary number of parameters</strong></p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="user.html#cb242-1" aria-hidden="true" tabindex="-1"></a>printParams <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb242-2"><a href="user.html#cb242-2" aria-hidden="true" tabindex="-1"></a>   params <span class="ot">&lt;-</span> <span class="fu">list</span>(...)</span>
<span id="cb242-3"><a href="user.html#cb242-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (p <span class="cf">in</span> params) <span class="fu">print</span>(p)</span>
<span id="cb242-4"><a href="user.html#cb242-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb242-5"><a href="user.html#cb242-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-6"><a href="user.html#cb242-6" aria-hidden="true" tabindex="-1"></a><span class="co"># call the above function with any random parameters</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="user.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printParams</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dv">5</span>, T, <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">y =</span> <span class="fu">c</span>(T, F)))</span></code></pre></div>
<pre><code>## [1] 1 2 3
## [1] 5
## [1] TRUE
##   x     y
## 1 1  TRUE
## 2 2 FALSE</code></pre>
</div>
<hr />
</div>
<div id="the-copy-on-modify-principle" class="section level3 hasAnchor" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> The “copy-on-modify” principle<a href="user.html#the-copy-on-modify-principle" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the more common questions raised when learning a new programming language is whether the functions work in “call-by-value” or “call-by-reference” mode. The difference is basically whether the function may change the content of the variables sent at the place of the formal argument or not; <em>call-by-value</em> principle forward only copies of original arguments. On the other hand, the <em>call-by-reference</em> principle makes it so the function receives “references” of the original variables, i.e. it behaves as if the original variables were passed to the function and all changes to them would be reflected in the calling function or program.</p>
<p>The language R uses a hybrid principle known as <em>copy-on-modify</em>. With this principle, references are forwarded to the function, which allows us to transmit “large” variables without the fear of them getting unnecessarily copied. But this is only valid if the function does not change the value of the resulting variables - at the moment when the function attempts to make any changes, copying the variable is carried out and the function continues to work on the copy.</p>
<p>Let’s check the above statements in a following examples.</p>
<hr />
</div>
<div id="example-7.1---copy-on-modify" class="section level3 hasAnchor" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Example 7.1 - “copy-on-modify”<a href="user.html#example-7.1---copy-on-modify" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="user.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a data frame</span></span>
<span id="cb245-2"><a href="user.html#cb245-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">name =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb245-3"><a href="user.html#cb245-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-4"><a href="user.html#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="co"># function changes a column and returns nothing</span></span>
<span id="cb245-5"><a href="user.html#cb245-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (assignment operator does not have a return value)</span></span>
<span id="cb245-6"><a href="user.html#cb245-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb245-7"><a href="user.html#cb245-7" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>name[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;change!&quot;</span></span>
<span id="cb245-8"><a href="user.html#cb245-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb245-9"><a href="user.html#cb245-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-10"><a href="user.html#cb245-10" aria-hidden="true" tabindex="-1"></a><span class="co"># the original data frame is unchanged</span></span>
<span id="cb245-11"><a href="user.html#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(df)</span>
<span id="cb245-12"><a href="user.html#cb245-12" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   id name
## 1  1    A
## 2  2    B
## 3  3    C
## 4  4    D
## 5  5    E</code></pre>
<p>The function actually creates a new temporary environment within which it stores “local” variables. In the above example, a new copy of the column in question is created and changed - but the original data frame column is unchanged.</p>
<p>It is important to note that the function could access an external variable even without sending it to the function, since by referencing the <code>x</code> variable that does not exist in the local environment the R search function will continue in the parent’s environment, which in this case would be the global environment. Attempting to change this variable would still fail - R would detect an attempt to change the variable and create a local copy of the same name.</p>
</div>
<div id="example-7.2---copy-on-modify-2" class="section level3 hasAnchor" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Example 7.2 - “copy-on-modify (2)”<a href="user.html#example-7.2---copy-on-modify-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="user.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a data frame</span></span>
<span id="cb247-2"><a href="user.html#cb247-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">name =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb247-3"><a href="user.html#cb247-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-4"><a href="user.html#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="co"># function changes a column of the external data frame and returns nothing</span></span>
<span id="cb247-5"><a href="user.html#cb247-5" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb247-6"><a href="user.html#cb247-6" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>name[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;change!&quot;</span></span>
<span id="cb247-7"><a href="user.html#cb247-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-8"><a href="user.html#cb247-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-9"><a href="user.html#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="co"># the original data frame is unchanged</span></span>
<span id="cb247-10"><a href="user.html#cb247-10" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb247-11"><a href="user.html#cb247-11" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   id name
## 1  1    A
## 2  2    B
## 3  3    C
## 4  4    D
## 5  5    E</code></pre>
<hr />
<p>One way to work around is is to wrap the data frame in its own environment. This way we can “force” the function to use <em>call-by-reference</em>, and at the same time ensure that no deep copies will be unnecessarily created.</p>
</div>
<div id="example-7.3---copy-on-modify-and-environments" class="section level3 hasAnchor" number="7.1.5">
<h3><span class="header-section-number">7.1.5</span> Example 7.3 - “copy-on-modify” and environments<a href="user.html#example-7.3---copy-on-modify-and-environments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="user.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a data frame in a new environment</span></span>
<span id="cb249-2"><a href="user.html#cb249-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">new.env</span>()</span>
<span id="cb249-3"><a href="user.html#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">parent.env</span>(e) <span class="ot">&lt;-</span> <span class="fu">emptyenv</span>()</span>
<span id="cb249-4"><a href="user.html#cb249-4" aria-hidden="true" tabindex="-1"></a>e<span class="sc">$</span>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">name =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb249-5"><a href="user.html#cb249-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-6"><a href="user.html#cb249-6" aria-hidden="true" tabindex="-1"></a><span class="co"># function changes a data frame using a reference from the environment</span></span>
<span id="cb249-7"><a href="user.html#cb249-7" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(e) {</span>
<span id="cb249-8"><a href="user.html#cb249-8" aria-hidden="true" tabindex="-1"></a>    e<span class="sc">$</span>df<span class="sc">$</span>name[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;change!&quot;</span></span>
<span id="cb249-9"><a href="user.html#cb249-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb249-10"><a href="user.html#cb249-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-11"><a href="user.html#cb249-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-12"><a href="user.html#cb249-12" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(e)</span>
<span id="cb249-13"><a href="user.html#cb249-13" aria-hidden="true" tabindex="-1"></a>e<span class="sc">$</span>df</span></code></pre></div>
<pre><code>##   id    name
## 1  1 change!
## 2  2       B
## 3  3       C
## 4  4       D
## 5  5       E</code></pre>
<hr />
<p>A simpler way of solving the above task would be using the <code>&lt;&lt;-</code> operator. This operator’s function is to change the variable of the given name that is located somewhere in the search path. R will follow the search path, and change the first occurrence of the specified variable. If the variable of this name does not exist anywhere in the search path, R will create a new variable in the first environment above the environment of the function.</p>
</div>
<div id="example-7.4---the---operator" class="section level3 hasAnchor" number="7.1.6">
<h3><span class="header-section-number">7.1.6</span> Example 7.4 - the <code>&lt;&lt;-</code> operator<a href="user.html#example-7.4---the---operator" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="user.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># operator `&lt;&lt;-`</span></span>
<span id="cb251-2"><a href="user.html#cb251-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb251-3"><a href="user.html#cb251-3" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;&lt;-</span> <span class="dv">7</span></span>
<span id="cb251-4"><a href="user.html#cb251-4" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb251-5"><a href="user.html#cb251-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb251-6"><a href="user.html#cb251-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-7"><a href="user.html#cb251-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb251-8"><a href="user.html#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb251-9"><a href="user.html#cb251-9" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>Let’s see how this would work with our data frame.</p>
</div>
<div id="example-7.5---changing-a-data-frame-column-with-the---operator" class="section level3 hasAnchor" number="7.1.7">
<h3><span class="header-section-number">7.1.7</span> Example 7.5 - changing a data frame column with the <code>&lt;&lt;-</code> operator<a href="user.html#example-7.5---changing-a-data-frame-column-with-the---operator" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="user.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a data frame</span></span>
<span id="cb253-2"><a href="user.html#cb253-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">name =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb253-3"><a href="user.html#cb253-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-4"><a href="user.html#cb253-4" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb253-5"><a href="user.html#cb253-5" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>name[<span class="dv">1</span>] <span class="ot">&lt;&lt;-</span> <span class="st">&quot;change!&quot;</span></span>
<span id="cb253-6"><a href="user.html#cb253-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb253-7"><a href="user.html#cb253-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-8"><a href="user.html#cb253-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb253-9"><a href="user.html#cb253-9" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   id    name
## 1  1 change!
## 2  2       B
## 3  3       C
## 4  4       D
## 5  5       E</code></pre>
<p>However this operator should be used very cautiously, and we will achieve greater robustness using the <code>assign</code> or<code>$</code>operator with reference to the environment where the variable we want to change is.</p>
<p>Finally, we must mention one feature of functions in R - the so-called. “lazy evaluation”. This simply means that R will not evaluate the received parameter until it is explicitly used. Up to that moment, this object is so-called. “promise” - R “knows” how to evaluate that object but it will not do so until it really needs it. This increases the efficiency of the language; if a parameter is used only in a conditional branch, then in scenarios when it is not needed it will not consume memory. But equally, we need to be careful because a lazy evaluation can lead to unexpected problems if we do not take into account its existence.</p>
</div>
<div id="function-as-an-object" class="section level3 hasAnchor" number="7.1.8">
<h3><span class="header-section-number">7.1.8</span> Function as an object<a href="user.html#function-as-an-object" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have already said that R has good support for the so-called “functional programming” which represents a programming paradigm that puts emphasis on designing functions without reliance on objects with interchangeable states. One of the characteristics of such languages are “first class functions”, which means that the language supports the definition of functions in such a way that they are equal objects to all other types of objects - they can be stored in a variable, used as an input argument of another function or as a return value, stored in other data structures, etc.</p>
<p>Let us show this on a trivial example. We know that R offers the function <code>sum</code> within the <code>base</code> package, and this function calculates the arithmetic sum of the vector elements we send to it as an input parameter. But <code>sum</code> is actually <em>the name of the variable</em> that references the code that implements this function. If we want, we can very easily bind this function to some other variable by which we have effectively changed its name, or - better said - provided an alternative way of calling from a completely different environment.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="user.html#cb255-1" aria-hidden="true" tabindex="-1"></a>sum2 <span class="ot">&lt;-</span> sum</span>
<span id="cb255-2"><a href="user.html#cb255-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-3"><a href="user.html#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum2</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)  <span class="co"># same as sum(1:10)</span></span></code></pre></div>
<p>This is easiest to understand in a way that the function is simply an “callable variable”, whereby the “call” refers to the use of a syntax that includes a reference to the function and input arguments framed in parentheses, which will return some value after execution in the R environment.</p>
<hr />
<p>The function can also be a return value from another function.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="user.html#cb256-1" aria-hidden="true" tabindex="-1"></a>funcCreator <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb256-2"><a href="user.html#cb256-2" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb256-3"><a href="user.html#cb256-3" aria-hidden="true" tabindex="-1"></a>    f</span>
<span id="cb256-4"><a href="user.html#cb256-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb256-5"><a href="user.html#cb256-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-6"><a href="user.html#cb256-6" aria-hidden="true" tabindex="-1"></a>newFunc <span class="ot">&lt;-</span> <span class="fu">funcCreator</span>() <span class="co"># we get the &quot;add one&quot; function</span></span>
<span id="cb256-7"><a href="user.html#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="fu">newFunc</span>(<span class="dv">5</span>)  </span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>The function simply creates a new function and returns it to the calling program as it would have done with any other object. The return value is stored in the variable that is now “callable” - if we add brackets and parameters it will be executed in the way it is defined within the function that created it.</p>
<p>Note that we could use the fact that the function returns the result of the last expression and define the function even shorter:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="user.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shorter definition</span></span>
<span id="cb258-2"><a href="user.html#cb258-2" aria-hidden="true" tabindex="-1"></a>funcCreator <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb258-3"><a href="user.html#cb258-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb258-4"><a href="user.html#cb258-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>These functions are often referred to as “factories” or “generators” of functions, and in contrast to the above example, in practice, the function generator often receives some parameters that determine how the returned function will behave.</p>
<p>Try to create a function factory that returns the multiplication functions using a pre-set parameter.</p>
<hr />
<p><strong>Exercise 7.5 - function factory</strong></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="user.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the `multiplicationFactory` function that creates </span></span>
<span id="cb259-2"><a href="user.html#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="co"># multiplication functions by the pre-set constant</span></span>
<span id="cb259-3"><a href="user.html#cb259-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-4"><a href="user.html#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the above function to create the `times2` function</span></span>
<span id="cb259-5"><a href="user.html#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="co"># which doubles the received number</span></span>
<span id="cb259-6"><a href="user.html#cb259-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-7"><a href="user.html#cb259-7" aria-hidden="true" tabindex="-1"></a><span class="co"># call the `times2` function with parameter 3 and print out the result</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="user.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the `multiplicationFactory` function that creates </span></span>
<span id="cb260-2"><a href="user.html#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="co"># multiplication functions by the pre-set constant</span></span>
<span id="cb260-3"><a href="user.html#cb260-3" aria-hidden="true" tabindex="-1"></a>multiplicationFactory <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb260-4"><a href="user.html#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(a) a<span class="sc">*</span>x</span>
<span id="cb260-5"><a href="user.html#cb260-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb260-6"><a href="user.html#cb260-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-7"><a href="user.html#cb260-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use the above function to create the `times2` function</span></span>
<span id="cb260-8"><a href="user.html#cb260-8" aria-hidden="true" tabindex="-1"></a><span class="co"># which doubles the received number</span></span>
<span id="cb260-9"><a href="user.html#cb260-9" aria-hidden="true" tabindex="-1"></a>times2 <span class="ot">&lt;-</span> <span class="fu">multiplicationFactory</span>(<span class="dv">2</span>)</span>
<span id="cb260-10"><a href="user.html#cb260-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-11"><a href="user.html#cb260-11" aria-hidden="true" tabindex="-1"></a><span class="co"># call the `times2` function with parameter 3 and print out the result</span></span>
<span id="cb260-12"><a href="user.html#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="fu">times2</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
</div>
<p>The <code>multiplicationFactory</code> function actually creates a “family” of functions that all provide the multiplication option with the selected number - i.e. parameter selected by the programmer itself. This way of managing functions may be initially confusing, but by using it in practice (which we will show in the next chapter), it is easy to notice the added flexibility and effectiveness of such an approach.</p>
<hr />
<p>If we define a function, and do not bind it to some variable, then we created the so-called “anonymous function”.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="user.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># anonymous function</span></span>
<span id="cb262-2"><a href="user.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x) x <span class="sc">*</span> x </span></code></pre></div>
<p>We can notice that each function is initially “anonymous”. If we return to the function definition syntax, we see that it is actually a combination of creating an anonymous function and binding it to a new variable. Of course, leaving the function anonymous as we did in the example above does not make much sense, just as it does not make sense to define a vector or list without creating a reference to that object - in that case the created object is not in any way usable because there are no links to it and will be quickly deleted by R within the “garbage collection” routine.</p>
<p>We can ask ourselves - is there a scenario where the anonymous function is meaningful and useful? Explicit anonymous functions are used when a “disposable” function is needed, for example, as an argument for some other function. If the function we want to send as an argument is easy to define in a single line, and we do not plan to use it afterwards in the program, then it makes no sense to define it separately and assign it its own reference. An example of this will be seen in the <code>apply</code> family of functions.</p>
<hr />
<p>At the end of this section, we repeat the most important things - in R, the function is an object like any other, the only specificity is that it is an object that is “executable”, ie, which, using the function call syntax, does some work and returns some value. Even anonymous function can be executed (although only once, since we do not have a reference for future calls).</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="user.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calling the anonymous function</span></span>
<span id="cb263-2"><a href="user.html#cb263-2" aria-hidden="true" tabindex="-1"></a>(<span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<hr />
</div>
</div>
<div id="the-apply-family" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> The <code>apply</code> family<a href="user.html#the-apply-family" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Very often, knowledge of the basics of the language R is reflected by the skill of using the so-called <code>apply</code> family of functions, available in the<code>base</code> package. These functions are specifically designed to perform repetitive tasks over various data structures, and as such they replace the program logic that would usually be realized in a through program loops. Additionally, these functions typically receive other functions as input arguments and, to a certain extent, encourage the functional programming paradigm.</p>
<p>The family name comes from the fact that these functions commonly have a suffix “apply”. Some of the functions from this family are:</p>
<ul>
<li><code>apply</code></li>
<li><code>lapply</code></li>
<li><code>sapply</code></li>
<li><code>vapply</code></li>
<li><code>tapply</code>,<code>mapply</code>, <code>rapply</code> …</li>
</ul>
<p>All of these functions work in a similar way - they receive a data set, a function that we want to apply to elements of that set, and optional additional parameters, and as the output give a set of function results, most often “packaged” in an appropriate format. The difference is mainly in the types of input and output arguments, as well as specific details about the implementation of the function itself and/or the way results are prepared.</p>
<p>This family of functions is best learned through examples. We will begin with the “basic” function - <code>apply</code>.</p>
<div id="the-apply-function" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> The <code>apply</code> function<a href="user.html#the-apply-function" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>apply</code> function is the only one that literally shares the name with the family of these functions. It is intended to work with <strong>matrices</strong> (actually with arrays, but since it is relatively rare to use data structures that have more than two dimensions, here we will focus only on matrices).</p>
<p>The command syntax is as follows:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="user.html#cb265-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">apply</span>( <span class="sc">&lt;</span>matrix<span class="sc">&gt;</span>, <span class="sc">&lt;</span><span class="fu">rows</span> (<span class="dv">1</span>) or <span class="fu">columns</span> (<span class="dv">2</span>)<span class="sc">&gt;</span>, <span class="sc">&lt;</span>function_name<span class="sc">&gt;</span> )</span></code></pre></div>
<p>Or, described in words, to implement the <code>apply</code> function, we:</p>
<ul>
<li>choose a matrix</li>
<li>decide whether to “cut it” by rows or columns</li>
<li>declare which function we want applied to each row (or column)</li>
</ul>
<p>Depending on how function works, as a result we get a matrix or (which is a more frequent case) a vector.</p>
<p>Let’s try to use this function in a concrete example.</p>
<hr />
<p><strong>Exercise 7.6 - the <code>apply</code> function</strong></p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="user.html#cb266-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb266-2"><a href="user.html#cb266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-3"><a href="user.html#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print matrix `m`</span></span>
<span id="cb266-4"><a href="user.html#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="user.html#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `apply` function to calculate</span></span>
<span id="cb266-6"><a href="user.html#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="co"># and print the column sums of the `m` matrix</span></span>
<span id="cb266-7"><a href="user.html#cb266-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-8"><a href="user.html#cb266-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-9"><a href="user.html#cb266-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `apply` function to calculate</span></span>
<span id="cb266-10"><a href="user.html#cb266-10" aria-hidden="true" tabindex="-1"></a><span class="co"># and print the multiplicaton of row elements </span></span>
<span id="cb266-11"><a href="user.html#cb266-11" aria-hidden="true" tabindex="-1"></a><span class="co"># from the `m` matrix </span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="user.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print matrix `m`</span></span>
<span id="cb267-2"><a href="user.html#cb267-2" aria-hidden="true" tabindex="-1"></a>m</span>
<span id="cb267-3"><a href="user.html#cb267-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-4"><a href="user.html#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;------------</span><span class="sc">\n</span><span class="st">&quot;</span>)  </span>
<span id="cb267-5"><a href="user.html#cb267-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-6"><a href="user.html#cb267-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `apply` function to calculate</span></span>
<span id="cb267-7"><a href="user.html#cb267-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and print the column sums of the `m` matrix</span></span>
<span id="cb267-8"><a href="user.html#cb267-8" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="dv">2</span>, sum)</span>
<span id="cb267-9"><a href="user.html#cb267-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-10"><a href="user.html#cb267-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;------------</span><span class="sc">\n</span><span class="st">&quot;</span>) </span>
<span id="cb267-11"><a href="user.html#cb267-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-12"><a href="user.html#cb267-12" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `apply` function to calculate</span></span>
<span id="cb267-13"><a href="user.html#cb267-13" aria-hidden="true" tabindex="-1"></a><span class="co"># and print the multiplicaton of row elements </span></span>
<span id="cb267-14"><a href="user.html#cb267-14" aria-hidden="true" tabindex="-1"></a><span class="co"># from the `m` matrix </span></span>
<span id="cb267-15"><a href="user.html#cb267-15" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="dv">1</span>, prod)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6
## [3,]    7    8    9
## ------------
## [1] 12 15 18
## ------------
## [1]   6 120 504</code></pre>
</div>
<hr />
<p>If we want to perform a custom task to the rows/columns, we often use an anonymous function, for example:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="user.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x) x[<span class="dv">1</span>])   <span class="co"># return the first element of each row</span></span></code></pre></div>
<hr />
<p><strong>Exercise 7.7 - the <code>apply</code> function and anonymous functions</strong></p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="user.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for each row of `m` calculate the natural logarithm</span></span>
<span id="cb270-2"><a href="user.html#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the sum of row elements</span></span>
<span id="cb270-3"><a href="user.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rounded to 2 decimals</span></span>
<span id="cb270-4"><a href="user.html#cb270-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `apply` function</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="user.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for each row of `m` calculate the natural logarithm</span></span>
<span id="cb271-2"><a href="user.html#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the sum of row elements</span></span>
<span id="cb271-3"><a href="user.html#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rounded to 2 decimals</span></span>
<span id="cb271-4"><a href="user.html#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `apply` function</span></span>
<span id="cb271-5"><a href="user.html#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">round</span>(<span class="fu">log</span>(<span class="fu">sum</span>(x)),<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 1.79 2.71 3.18</code></pre>
</div>
<hr />
<p>Let’s repeat - <code>apply</code> (and related functions) implicitly <em>disassembles the input data structure into elements</em>. In the examples above, these elements - rows or columns - are actually numeric vectors. The argument <code>x</code> received by an anonymous function is exactly that vector, or, better said <em>each of these vectors</em> that are sent one by one. <em>The results of the function are “remembered” and “packed”</em> into the final result.</p>
<p>Let’s try to program the last example without using the <code>apply</code> function.</p>
<hr />
<p><strong>Exercise 7.8 - loop as the alternative to the <code>apply</code> function</strong></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="user.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for each row of `m` calculate the natural logarithm</span></span>
<span id="cb273-2"><a href="user.html#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the sum of row elements</span></span>
<span id="cb273-3"><a href="user.html#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rounded to 2 decimals</span></span>
<span id="cb273-4"><a href="user.html#cb273-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the for program loop</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="user.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for each row of `m` calculate the natural logarithm</span></span>
<span id="cb274-2"><a href="user.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of the sum of row elements</span></span>
<span id="cb274-3"><a href="user.html#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="co"># rounded to 2 decimals</span></span>
<span id="cb274-4"><a href="user.html#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the for program loop</span></span>
<span id="cb274-5"><a href="user.html#cb274-5" aria-hidden="true" tabindex="-1"></a>rez <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">nrow</span>(m))</span>
<span id="cb274-6"><a href="user.html#cb274-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(m)) rez[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">log</span>(<span class="fu">sum</span>(m[i,])), <span class="dv">2</span>)</span>
<span id="cb274-7"><a href="user.html#cb274-7" aria-hidden="true" tabindex="-1"></a>rez</span></code></pre></div>
<pre><code>## [1] 1.79 2.71 3.18</code></pre>
</div>
<hr />
<p>If we compare the syntax of the examples with and without using the <code>apply</code> function, we can see how much the syntax which uses <code>apply</code> s actually “cleaner”. If we use loops, we must explicitly specify the logic of passing through the structure, which draws attention away from the job description that we actually want to do.</p>
<p>What if we want to send to the <code>apply</code> function a function which needs several parameters? For example, let’s say that instead of the upper function that extracts the first line element we want a function with two parameters - the first a vector (matrix row or column), and the second an integer that indicates the index of the element to extract. The answer is simple - just add additional parameters at the end of the function call.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="user.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># apply function and input function with multiple parameters</span></span>
<span id="cb276-2"><a href="user.html#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(m, <span class="dv">1</span>, <span class="cf">function</span>(x,y) x[y], <span class="dv">2</span>)  <span class="co"># second element of each row</span></span></code></pre></div>
<p>Finally, it should be noted that for similar processing of data in the matrix form, we do not necessarily need to use <code>apply</code> - many popular operations such as adding row or column elements, calculating the average of the elements of the rows and columns, and the like. This has already been implemented through functions such as <code>rowSums</code>,<code>colSums</code>, <code>rowMeans</code>,<code>colMeans</code> and the like. They are easier to use, but specialized - for more flexibility, the most common option is <code>apply</code>.</p>
<hr />
</div>
<div id="the-lapply-sapply-and-vapply-functions" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> The <code>lapply</code>, <code>sapply</code> and <code>vapply</code> functions<a href="user.html#the-lapply-sapply-and-vapply-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The name of the <code>lapply</code> function comes from <em>list apply</em> - i.e. <strong>apply the function to the elements of lists</strong>. To put simply - it is a function that will receive the <strong>list and a function</strong> as the input arguments, apply the functions to <strong>each individual list element</strong> and return again <strong>a new list</strong> as a result.</p>
<hr />
<p><strong>Exercise 7.9 - the <code>lapply</code> function</strong></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="user.html#cb277-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">b =</span> <span class="fu">rep</span>(<span class="fu">c</span>(T, F), <span class="dv">10</span>), <span class="at">c =</span> LETTERS)</span>
<span id="cb277-2"><a href="user.html#cb277-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-3"><a href="user.html#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `lapply` function to calculate the length (number of elements)</span></span>
<span id="cb277-4"><a href="user.html#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="co"># of each element of the `l` list</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="user.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `lapply` function to calculate the length (number of elements)</span></span>
<span id="cb278-2"><a href="user.html#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of each element of the `l` list</span></span>
<span id="cb278-3"><a href="user.html#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(l, length)</span></code></pre></div>
<pre><code>## $a
## [1] 3
## 
## $b
## [1] 20
## 
## $c
## [1] 26</code></pre>
</div>
<hr />
<p>Just like with the <code>apply</code> function, for the<code>lapply</code> function, we often use anonymous functions as a parameter. The following task has no special practical use, but it will help us understand the functionality of the <code>lapply</code> function in combination with a slightly more complex anonymous function.</p>
<hr />
<p><strong>Exercise 7.10 - the <code>lapply</code> function and anonymous functions</strong></p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="user.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># process the elements of the `l &#39;list as follows:</span></span>
<span id="cb280-2"><a href="user.html#cb280-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-3"><a href="user.html#cb280-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Calculate the mean value if it is a numerical vector</span></span>
<span id="cb280-4"><a href="user.html#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - count the values of TRUE if it is a logical vector</span></span>
<span id="cb280-5"><a href="user.html#cb280-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - calculate the length of the vector for all other cases</span></span>
<span id="cb280-6"><a href="user.html#cb280-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-7"><a href="user.html#cb280-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `lapply` function and an anonymous function</span></span>
<span id="cb280-8"><a href="user.html#cb280-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-9"><a href="user.html#cb280-9" aria-hidden="true" tabindex="-1"></a><span class="co"># do not forget that anonymous function can also use blocks!</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="user.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># process the elements of the `l &#39;list as follows:</span></span>
<span id="cb281-2"><a href="user.html#cb281-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-3"><a href="user.html#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - Calculate the mean value if it is a numerical vector</span></span>
<span id="cb281-4"><a href="user.html#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - count the values of TRUE if it is a logical vector</span></span>
<span id="cb281-5"><a href="user.html#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - calculate the length of the vector for all other cases</span></span>
<span id="cb281-6"><a href="user.html#cb281-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-7"><a href="user.html#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `lapply` function and an anonymous function</span></span>
<span id="cb281-8"><a href="user.html#cb281-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-9"><a href="user.html#cb281-9" aria-hidden="true" tabindex="-1"></a><span class="co"># do not forget that anonymous function can also use blocks!</span></span>
<span id="cb281-10"><a href="user.html#cb281-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-11"><a href="user.html#cb281-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(l, <span class="cf">function</span>(x) {</span>
<span id="cb281-12"><a href="user.html#cb281-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb281-13"><a href="user.html#cb281-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb281-14"><a href="user.html#cb281-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.logical</span>(x)) {</span>
<span id="cb281-15"><a href="user.html#cb281-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb281-16"><a href="user.html#cb281-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="fu">length</span>(x)</span>
<span id="cb281-17"><a href="user.html#cb281-17" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## $a
## [1] 2
## 
## $b
## [1] 10
## 
## $c
## [1] 26</code></pre>
</div>
<hr />
<p>The <code>lapply</code> function is essentially quite simple to use and is very popular due to this fact. But once we use it for a while, we can find it irritating that t it always returns the list as a result, although some other data structure would be more suitable for us - for example a vector, especially if the resulting list has just simple numbers as elements. For this reason, R offers the <code>unlist</code> function to simplify the list to a vector.</p>
<hr />
<p><strong>Exercise 7.11 - the <code>unlist</code> function</strong></p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="user.html#cb283-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">b =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">c =</span> <span class="dv">100</span><span class="sc">:</span><span class="dv">200</span>)</span>
<span id="cb283-2"><a href="user.html#cb283-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-3"><a href="user.html#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean value of the elements of the `l` list</span></span>
<span id="cb283-4"><a href="user.html#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print the results as a numeric vector</span></span>
<span id="cb283-5"><a href="user.html#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="co"># use `lapply` and `unlist`</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="user.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean value of the elements of the `l` list</span></span>
<span id="cb284-2"><a href="user.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print the results as a numeric vector</span></span>
<span id="cb284-3"><a href="user.html#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use `lapply` and `unlist`</span></span>
<span id="cb284-4"><a href="user.html#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">lapply</span>(l, mean))</span></code></pre></div>
<pre><code>##     a     b     c 
##   5.5  15.0 150.0</code></pre>
</div>
<hr />
<p>The displayed combination of <code>lapply</code> and<code>unlist</code> will give us as a result a one-dimensional vector, which in many cases is what we want. But sometimes some other data structure would suit us - for example, a matrix. In this case we need an additional step in transforming a one-dimensional vector into a matrix using the <code>matrix</code> function, with the number of rows and columns being explicitly assigned.</p>
<p>The question may arise - why is <code>lapply</code> not able to check the structure of the result it has created and determine the optimal data structure for formatting it (vector, matrix, or list)? That’s exactly the idea behind the <code>sapply</code> function, or <em>simplified list apply</em>. This function first performs <code>lapply</code> internally, and then simplifies the result to a vector, matrix or array, depending on the characteristics of the results obtained.</p>
<hr />
<p><strong>Exercise 7.12 - the <code>sapply</code> function</strong></p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="user.html#cb286-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">b =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">c =</span> <span class="dv">100</span><span class="sc">:</span><span class="dv">200</span>)</span>
<span id="cb286-2"><a href="user.html#cb286-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-3"><a href="user.html#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the median of elements of the `l` list</span></span>
<span id="cb286-4"><a href="user.html#cb286-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and collect the results in a numeric vector</span></span>
<span id="cb286-5"><a href="user.html#cb286-5" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `sapply` function</span></span>
<span id="cb286-6"><a href="user.html#cb286-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-7"><a href="user.html#cb286-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-8"><a href="user.html#cb286-8" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the first and last element of each of the elements of the `l` list</span></span>
<span id="cb286-9"><a href="user.html#cb286-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use `sapply` and anonymous function</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="user.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the median of elements of the `l` list</span></span>
<span id="cb287-2"><a href="user.html#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and collect the results in a numeric vector</span></span>
<span id="cb287-3"><a href="user.html#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `sapply` function</span></span>
<span id="cb287-4"><a href="user.html#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(l, median)</span>
<span id="cb287-5"><a href="user.html#cb287-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-6"><a href="user.html#cb287-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;------------</span><span class="sc">\n</span><span class="st">&quot;</span>) </span>
<span id="cb287-7"><a href="user.html#cb287-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-8"><a href="user.html#cb287-8" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the first and last element of each of the elements of the `l` list</span></span>
<span id="cb287-9"><a href="user.html#cb287-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use `sapply` and anonymous function</span></span>
<span id="cb287-10"><a href="user.html#cb287-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(l, <span class="cf">function</span>(x) <span class="fu">c</span>(x[<span class="dv">1</span>], x[<span class="fu">length</span>(x)]))</span></code></pre></div>
<pre><code>##     a     b     c 
##   5.5  15.0 150.0 
## ------------
##       a  b   c
## [1,]  1 10 100
## [2,] 10 20 200</code></pre>
</div>
<hr />
<p>Note that as a result in the last example, we received a matrix, but that R formed it “by columns”. If we wanted a matrix with elements arranged in rows, we can not use <code>sapply</code> for this directly, because the matrix is formed internally, without the possibility of forwarding the<code>byrow = T</code> parameter. To obtain such a matrix, one option is already mentioned with the combination of <code>lapply</code>,<code>unlist</code> and <code>matrix</code>, or - more simply - transposing the<code>sapply</code> results using <code>t</code> function (from <em>transpose</em>).</p>
<hr />
<p>The <code>sapply</code> function is quite popular due to its simplicity and efficiency, so it is relatively often used in interactive analysis. On the other hand, the use of this function in program scripts is not recommended since its result is unpredictable in the general case - e.g. the script can expect a matrix in the continuation of the code, and the <code>sapply</code> function, due to the specificity of the input data, returns the vector, which can cause unforeseen results, which is not easy to spot later and diagnose where the error occurred.</p>
<p>If we are developing our own programs in R and want to use <code>sapply</code>, then the better choice will be the<code>vapply</code> function, which works identically to <code>sapply</code>, but uses an additional parameter called <code>FUN.VALUE</code> with which we explicitly define what kind of “simplification” we expect. For example. <code>numeric(3)</code> means that the result of applying the function to each element of the original list should be a numeric vector of three elements. If the result for any list item differs from the expected one, the function will raise an error.</p>
<hr />
<p><strong>Exercise 7.13 - the <code>vapply</code> function</strong></p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="user.html#cb289-1" aria-hidden="true" tabindex="-1"></a>myList <span class="ot">&lt;-</span> <span class="fu">list</span>(numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), </span>
<span id="cb289-2"><a href="user.html#cb289-2" aria-hidden="true" tabindex="-1"></a>               names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ivo&quot;</span>, <span class="st">&quot;Pero&quot;</span>, <span class="st">&quot;Ana&quot;</span>), </span>
<span id="cb289-3"><a href="user.html#cb289-3" aria-hidden="true" tabindex="-1"></a>               alphabet <span class="ot">&lt;-</span> LETTERS)</span>
<span id="cb289-4"><a href="user.html#cb289-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-5"><a href="user.html#cb289-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-6"><a href="user.html#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="co"># think which of the following calls will be successful,</span></span>
<span id="cb289-7"><a href="user.html#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and which will throw out the error</span></span>
<span id="cb289-8"><a href="user.html#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="co"># check the results on the console</span></span>
<span id="cb289-9"><a href="user.html#cb289-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-10"><a href="user.html#cb289-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(myList, length, <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb289-11"><a href="user.html#cb289-11" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(myList, <span class="cf">function</span>(x) <span class="fu">as.character</span>(<span class="fu">c</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>])), <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">2</span>))</span>
<span id="cb289-12"><a href="user.html#cb289-12" aria-hidden="true" tabindex="-1"></a><span class="fu">vapply</span>(myList, <span class="cf">function</span>(x) <span class="fu">as.logical</span>(x), <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>))</span></code></pre></div>
<hr />
<p>Finally, let’s return briefly to <code>lapply</code> and consider one important fact - it is intended for use on lists, and <strong>data frames are actually lists</strong>. In other words, the <code>lapply</code> function is very handy for processing tabular datasets when we want to apply a particular function to the columns of the data frame.</p>
<p>One of the more frequent operations performed in data analysis is the so-called. “standardization” of the numeric columns of the data frame - i.e. reducing all numerical values to “normal” distribution with the arithmetic mean of 0 and standard deviation of 1. This can be done by reducing each individual value by the arithmetic mean of the column (the <code>mean</code> function) and dividing with standard deviation of the column (function <code>sd</code>). This is a great way to demonstrate the use of <code>lapply</code> with data frames.</p>
<hr />
<p><strong>Exercise 7.14 - the <code>lapply</code> function and data frames</strong></p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="user.html#cb290-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">b =</span> <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">550</span>, <span class="dv">50</span>), </span>
<span id="cb290-2"><a href="user.html#cb290-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">c =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="at">d =</span> <span class="fu">rep</span>(<span class="fu">c</span>(T,F), <span class="dv">5</span>), </span>
<span id="cb290-3"><a href="user.html#cb290-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">e =</span> <span class="sc">-</span><span class="dv">10</span><span class="sc">:-</span><span class="dv">1</span>)</span>
<span id="cb290-4"><a href="user.html#cb290-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-5"><a href="user.html#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize numerical columns using `lapply`</span></span>
<span id="cb290-6"><a href="user.html#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="co"># do not change the remaining columns</span></span>
<span id="cb290-7"><a href="user.html#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="co"># round the normalized values to three decimal places</span></span>
<span id="cb290-8"><a href="user.html#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="co"># save the result in the df variable</span></span>
<span id="cb290-9"><a href="user.html#cb290-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-10"><a href="user.html#cb290-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print df</span></span></code></pre></div>
<div class="fold s o">
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="user.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize numerical columns using `lapply`</span></span>
<span id="cb291-2"><a href="user.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="co"># do not change the remaining columns</span></span>
<span id="cb291-3"><a href="user.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="co"># round the normalized values to three decimal places</span></span>
<span id="cb291-4"><a href="user.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="co"># save the result in the df variable</span></span>
<span id="cb291-5"><a href="user.html#cb291-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df, <span class="cf">function</span>(x) {</span>
<span id="cb291-6"><a href="user.html#cb291-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb291-7"><a href="user.html#cb291-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sd</span>(x), <span class="dv">3</span>)</span>
<span id="cb291-8"><a href="user.html#cb291-8" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> x })</span>
<span id="cb291-9"><a href="user.html#cb291-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-10"><a href="user.html#cb291-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print df</span></span>
<span id="cb291-11"><a href="user.html#cb291-11" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## $a
##  [1] -1.486 -1.156 -0.826 -0.495 -0.165  0.165  0.495  0.826  1.156  1.486
## 
## $b
##  [1] -1.486 -1.156 -0.826 -0.495 -0.165  0.165  0.495  0.826  1.156  1.486
## 
## $c
##  [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot; &quot;H&quot; &quot;I&quot; &quot;J&quot;
## 
## $d
##  [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE
## 
## $e
##  [1] -1.486 -1.156 -0.826 -0.495 -0.165  0.165  0.495  0.826  1.156  1.486</code></pre>
</div>
<hr />
<p>We see that after using <code>lapply</code> we get a list and that if we want the result in the form of a data frame we need to add another step using the<code>as.data.frame</code> function. If we are looking for a simpler way that immediately gives the data frame as a result, there is one convenient “trick” that we will explain below.</p>
<p>Let’s look at the solution of the previous problem, and put the following little change in the assignment of the result of the <code>lapply</code> function:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="user.html#cb293-1" aria-hidden="true" tabindex="-1"></a>df[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(...)</span></code></pre></div>
<p>In this way, R will not create a “new” variable named <code>df</code>, but rather the<code>lapply</code> result will be entered in the ’all rows and columns of the <code>df</code> data frame. This made it possible for us to get the result in the form of a data frame, which we actually wanted. For this very reason, in R scripts, we will often see a similar syntax (<code>df [] &lt;- lapply ...</code>). Try to modify the above example in the above manner and make sure that the result will be a data frame.</p>
<p>Another commonly used trick in working with data frames is the following command:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="user.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(df, class)   </span></code></pre></div>
<p>This command actually gives us the answer to the question - which types are the columns of the given data frame? Although there are other ways to get this information, this method is popular both because of the compactness of the results and the independence of additional packages.</p>
</div>
<div id="other-functions-from-the-apply-family-and-the-available-alternatives" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Other functions from the <code>apply</code> family and the available alternatives<a href="user.html#other-functions-from-the-apply-family-and-the-available-alternatives" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the previous chapters, we have probably listed the most popular members of the <code>apply</code> family. This family has more members, including some who do not have a suffix <em>-apply</em>:</p>
<ul>
<li><code>mapply</code>, which works in parallel over multiple data structures</li>
<li><code>rapply</code>, which recursively applies functions within the structure</li>
<li><code>tapply</code>, which applies functions over sub-groups within a structure defined by factors</li>
<li><code>Map</code>, the<code>mapply</code> version, which does not simplify the result</li>
<li><code>by</code>, the<code>tapply</code> version for data frames</li>
<li>etc.</li>
</ul>
<p>The reason why these functions will not be explained in detail is twofold: firstly, as already mentioned, these functions are in practice applied much less often than the functions we have shown in the previous chapters. Secondly, with the increase in popularity of the language R, a large number of packages are oriented to improve the existing functions of the language R in the sense of easier and more efficient programming, especially when working with data frames.</p>
<p>If we are looking for convenient alternative functions to those from the <code>apply</code> family, it’s recommended to look at some of the following packages</p>
<ul>
<li><code>plyr</code> - an extremely popular package that, among other things, offers a number of functions very similar to <code>apply</code> functions, but derived in a way that they have a consistent signature and explicitly defined input and output formats that are easily read from the function name itself (in particular, the first letters ); so the <code>llply</code> function uses a list as both the input and the output, while<code>mdply</code> needs a matrix as input and outputs a data frame</li>
<li><code>purrr</code> - a package that replaces the functions of the<code>apply</code> family with functions corresponding to similar functions from other programming languages; since the application of the same function to a number of elements of a data structure in functional languages is often called “mapping”, the set of functions of this package carries the prefix <code>maps_</code>, and the function names often correspond to the expected results (for example<code>map2_lgl</code> means that as a result we expect a logical vector , and the <code>map2_df</code> a data frame)</li>
<li><code>dplyr</code> - a relatively new package, which in a certain sense represents the successor of the <code>plyr</code> package but oriented almost exclusively toward data frames; the functions of this package are not so much oriented to replace the <code>apply</code> family functions as providing a specific platform for working with data frames in a manner similar to languages oriented precisely for this purpose, such as, for example, the SQL language</li>
</ul>
<p>In future lectures we will introduce the <code>dplyr</code> package precisely because this package greatly facilitates and accelerates the data analysis process and is extremely well accepted in the R community.</p>
<hr />
</div>
</div>
<div id="homework-exercises-5" class="section level2 unnumbered hasAnchor">
<h2>Homework exercises<a href="user.html#homework-exercises-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>R has a <code>which</code> function which converts a logical vector into a numeric one containing indexes where the original vector has a <code>TRUE</code> value (so <code>c(T, F, F, F, F, T, F, T)</code> becomes <code>c(1, 6, 8)</code>). Create a function which replicates this behaviour.</p></li>
<li><p>Take the numerical vector <code>x</code> of length <code>n</code>. In statistics, the standardized moment of the k-th order is calculated like this:</p></li>
</ol>
<p><span class="math display">\[\frac{1}{n}\sum_{i=1}^n{(x_i - \bar{x})}^{k+1}\]</span></p>
<p>Create a factory of moment functions (<code>moment(k)</code>) for calculating the standardized central moment of the k-th order.</p>
<p>Create the functions <code>zero_moment(x)</code> and <code>first_moment(x)</code> with parameter values <code>k</code> set to <code>0</code> and <code>1</code> accordingly.</p>
<p>Test the functions on vector <code>1:1000</code>. Compare the results given by the <code>sd</code> (standard deviation) function over the vector <code>1:1000</code> and root of the first moment you have calculated.</p>
<ol start="3" style="list-style-type: decimal">
<li>Take the <code>m</code> matrix created by the following command:</li>
</ol>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="user.html#cb295-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">5</span>), <span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">100</span>))</span></code></pre></div>
<p>With the <code>apply</code> function and the new anonymous function, create a vector that will contain the first even element of each row, or zero if the corresponding row does not have even elements.</p>
<ol start="4" style="list-style-type: decimal">
<li>The following commands will create a list of 100 elements where each element will be a numeric vector of a random length of 1 to 10.</li>
</ol>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="user.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb296-2"><a href="user.html#cb296-2" aria-hidden="true" tabindex="-1"></a>myList <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">100</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>)))</span></code></pre></div>
<p>With the help of <code>lapply</code> / <code>sapply</code> (and additional commands if necessary), create:</p>
<ul>
<li>the numerical vector <code>v</code> with the lengths of the list elements</li>
<li>list <code>l</code> with normalized numerical vectors of the original list</li>
<li>numerical vector <code>ind4</code> with indexes of all list elements containing number 4</li>
<li>the <code>df5</code> data frame containing columns which have all the elements of the length of 5 from the original list</li>
</ul>
<hr />
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Programirajmo u R-u</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://www.fer.unizg.hr/en/damir.pintar" property="cc:attributionName" rel="cc:attributionURL">Damir Pintar</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://ratnip.github.io/FER_OPJR/" rel="dct:source">https://ratnip.github.io/FER_OPJR/</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="packages.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="objects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed",
"edit": null,
"download": null,
"search": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
